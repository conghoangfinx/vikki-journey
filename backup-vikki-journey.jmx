<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.6.3">
  <hashTree>
    <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="Vikki Journey">
      <boolProp name="TestPlan.functional_mode">true</boolProp>
      <boolProp name="TestPlan.serialize_threadgroups">true</boolProp>
      <elementProp name="TestPlan.user_defined_variables" elementType="Arguments" guiclass="ArgumentsPanel" testclass="Arguments" testname="User Defined Variables">
        <collectionProp name="Arguments.arguments"/>
      </elementProp>
      <stringProp name="TestPlan.user_define_classpath">./lib</stringProp>
    </TestPlan>
    <hashTree>
      <Arguments guiclass="ArgumentsPanel" testclass="Arguments" testname="User Defined Variables - UAT">
        <collectionProp name="Arguments.arguments">
          <elementProp name="scheme" elementType="Argument">
            <stringProp name="Argument.name">scheme</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
            <stringProp name="Argument.value">https</stringProp>
          </elementProp>
          <elementProp name="host" elementType="Argument">
            <stringProp name="Argument.name">host</stringProp>
            <stringProp name="Argument.value">ingress-int.uat.galaxyfinx.in</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
            <stringProp name="Argument.desc">UAT</stringProp>
          </elementProp>
          <elementProp name="internalKey" elementType="Argument">
            <stringProp name="Argument.name">internalKey</stringProp>
            <stringProp name="Argument.value">UvzUJdDucBtgFvNxu9F7XzpyA</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="adminKey" elementType="Argument">
            <stringProp name="Argument.name">adminKey</stringProp>
            <stringProp name="Argument.value">yZn7UbifwbvhuNihUsvYOgurk</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="publicKey" elementType="Argument">
            <stringProp name="Argument.name">publicKey</stringProp>
            <stringProp name="Argument.value">GfS39omUfRHReT3G02sSYTIpF</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="hpvOcrMockingId" elementType="Argument">
            <stringProp name="Argument.name">hpvOcrMockingId</stringProp>
            <stringProp name="Argument.value">825cace7-8678-41c3-bc8a-7303c5260bd6</stringProp>
            <stringProp name="Argument.desc">Wiremock ID</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="hdbBiometricMockingId" elementType="Argument">
            <stringProp name="Argument.name">hdbBiometricMockingId</stringProp>
            <stringProp name="Argument.value">bf3e65fb-4fc0-4cea-bccc-d4c906744ea3</stringProp>
            <stringProp name="Argument.desc">Wiremock ID</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="phoneNumberOnboard" elementType="Argument">
            <stringProp name="Argument.name">phoneNumberOnboard</stringProp>
            <stringProp name="Argument.value">990010130</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
            <stringProp name="Argument.desc"></stringProp>
          </elementProp>
          <elementProp name="idNumberOnboard" elementType="Argument">
            <stringProp name="Argument.name">idNumberOnboard</stringProp>
            <stringProp name="Argument.value">001098034130</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
        </collectionProp>
      </Arguments>
      <hashTree/>
      <Arguments guiclass="ArgumentsPanel" testclass="Arguments" testname="User Defined Variables - SIT" enabled="false">
        <collectionProp name="Arguments.arguments">
          <elementProp name="scheme" elementType="Argument">
            <stringProp name="Argument.name">scheme</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
            <stringProp name="Argument.value">https</stringProp>
          </elementProp>
          <elementProp name="host" elementType="Argument">
            <stringProp name="Argument.name">host</stringProp>
            <stringProp name="Argument.value">ingress-int.sit.galaxyfinx.in</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
            <stringProp name="Argument.desc">UAT</stringProp>
          </elementProp>
          <elementProp name="internalKey" elementType="Argument">
            <stringProp name="Argument.name">internalKey</stringProp>
            <stringProp name="Argument.value">hF35bcI4A2g6JUb4lrs0cvM5t</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="adminKey" elementType="Argument">
            <stringProp name="Argument.name">adminKey</stringProp>
            <stringProp name="Argument.value">5jrEGY49i8OV8tmEOC5euLQW6</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="publicKey" elementType="Argument">
            <stringProp name="Argument.name">publicKey</stringProp>
            <stringProp name="Argument.value">uX6YVolBtq4lEOsFBYitJrR8B</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="hpvOcrMockingId" elementType="Argument">
            <stringProp name="Argument.name">hpvOcrMockingId</stringProp>
            <stringProp name="Argument.value">825cace7-8678-41c3-bc8a-7303c5260bd6</stringProp>
            <stringProp name="Argument.desc">Wiremock ID</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="hdbBiometricMockingId" elementType="Argument">
            <stringProp name="Argument.name">hdbBiometricMockingId</stringProp>
            <stringProp name="Argument.value">bf3e65fb-4fc0-4cea-bccc-d4c906744ea3</stringProp>
            <stringProp name="Argument.desc">Wiremock ID</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
          <elementProp name="phoneNumberOnboard" elementType="Argument">
            <stringProp name="Argument.name">phoneNumberOnboard</stringProp>
            <stringProp name="Argument.value">990010199</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
            <stringProp name="Argument.desc"></stringProp>
          </elementProp>
          <elementProp name="idNumberOnboard" elementType="Argument">
            <stringProp name="Argument.name">idNumberOnboard</stringProp>
            <stringProp name="Argument.value">001098034158</stringProp>
            <stringProp name="Argument.metadata">=</stringProp>
          </elementProp>
        </collectionProp>
      </Arguments>
      <hashTree/>
      <ConfigTestElement guiclass="HttpDefaultsGui" testclass="ConfigTestElement" testname="HTTP Request Defaults" enabled="true">
        <stringProp name="HTTPSampler.domain">${host}</stringProp>
        <stringProp name="HTTPSampler.port">443</stringProp>
        <stringProp name="HTTPSampler.protocol">${scheme}</stringProp>
        <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="User Defined Variables">
          <collectionProp name="Arguments.arguments"/>
        </elementProp>
        <stringProp name="HTTPSampler.implementation"></stringProp>
      </ConfigTestElement>
      <hashTree/>
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="Onboarding" enabled="true">
        <intProp name="ThreadGroup.num_threads">1</intProp>
        <intProp name="ThreadGroup.ramp_time">1</intProp>
        <stringProp name="ThreadGroup.duration">${__P(durations,600)}</stringProp>
        <longProp name="ThreadGroup.delay">5</longProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">false</boolProp>
        <stringProp name="ThreadGroup.on_sample_error">stoptestnow</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="Loop Controller">
          <stringProp name="LoopController.loops">1</stringProp>
          <boolProp name="LoopController.continue_forever">false</boolProp>
        </elementProp>
      </ThreadGroup>
      <hashTree>
        <IfController guiclass="IfControllerPanel" testclass="IfController" testname="0. Clear Card" enabled="true">
          <stringProp name="IfController.condition">true</stringProp>
          <boolProp name="IfController.evaluateAll">false</boolProp>
          <boolProp name="IfController.useExpression">true</boolProp>
        </IfController>
        <hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="Tìm Lead và Xóa">
            <stringProp name="HTTPSampler.domain">113.161.76.226</stringProp>
            <stringProp name="HTTPSampler.port">8087</stringProp>
            <stringProp name="HTTPSampler.protocol">http</stringProp>
            <stringProp name="HTTPSampler.path">/hdb-lead-card-management/api/lead/find_lead</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;inputData&quot;: [&#xd;
        &quot;${idNumberOnboard}&quot;&#xd;
    ],&#xd;
    &quot;searchLeadDetailMethod&quot;: &quot;NATIONAL_ID&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">x-api-key</stringProp>
                  <stringProp name="Header.value">szt995RHr033WwY616SWj831YAS346bK</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">log.info(&quot; \n ---------- SEARCH CARD LEAD AND DELETE ----------&quot;);

import groovy.json.JsonSlurper;
import org.apache.jmeter.samplers.SampleResult;
import org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy;
import org.apache.jmeter.protocol.http.control.HeaderManager;
import org.apache.jmeter.protocol.http.control.Header;
import org.apache.jmeter.threads.JMeterContext;

// ✅ Lấy thông tin từ request trước đó
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);

// ✅ Lấy response JSON từ request trước đó
def response = prev.getResponseDataAsString().trim();
def jsonSlurper = new JsonSlurper();
def jsonResponse;

// ✅ Parse JSON an toàn
try {
    jsonResponse = jsonSlurper.parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Kiểm tra nếu có leads trong response
if (jsonResponse?.leads?.size() &gt; 0) {
    def leadIds = jsonResponse.leads.collect { it.leadId };
    vars.put(&quot;leadIds&quot;, leadIds.join(&quot;,&quot;)); // Lưu danh sách leadId vào biến JMeter
    
    log.info(&quot;🔹 Danh sách leadIds đã trích xuất: &quot; + leadIds);

    // ✅ Gửi yêu cầu xóa từng leadId
    leadIds.each { leadId -&gt;
        log.info(&quot;🛑 Đang gửi yêu cầu xóa leadId: &quot; + leadId);
        
        // ✅ Tạo HTTP Sampler để gửi request động
        def sampler = new HTTPSamplerProxy();
        sampler.setDomain(&quot;113.161.76.226&quot;);
        sampler.setPort(8087);
        sampler.setProtocol(&quot;http&quot;);
        sampler.setPath(&quot;/hdb-lead-card-management/api/lead/remove_lead&quot;);
        sampler.setMethod(&quot;PUT&quot;);
        
        // ✅ Thiết lập Header Manager
        def headerManager = new HeaderManager();
        headerManager.add(new Header(&quot;Content-Type&quot;, &quot;application/json&quot;));
        headerManager.add(new Header(&quot;x-api-key&quot;, &quot;szt995RHr033WwY616SWj831YAS346bK&quot;));
        sampler.setHeaderManager(headerManager);

        // ✅ Thiết lập Body
        def requestBody = &apos;{&quot;leads&quot;: [&quot;&apos; + leadId + &apos;&quot;]}&apos;;
        sampler.addNonEncodedArgument(&quot;&quot;, requestBody, &quot;&quot;);
        sampler.setPostBodyRaw(true);

        // ✅ Gửi request bằng SampleResult
        def sampleResult = sampler.sample();
        
        // ✅ Ghi log kết quả
        log.info(&quot; Request: DELETE Lead ID: &quot; + leadId);
        log.info(&quot; Response Code: &quot; + sampleResult.getResponseCode());
        log.info(&quot; Response Message: &quot; + sampleResult.getResponseMessage());

        if (sampleResult.getResponseCode() != &quot;200&quot;) {
            log.warn(&quot;❌ Lỗi khi xóa leadId: &quot; + leadId + &quot; | Response: &quot; + sampleResult.getResponseDataAsString());
        } else {
            log.info(&quot;✅ Đã xóa thành công leadId: &quot; + leadId);
        }
    }
} else {
    log.warn(&quot;✅ Không có lead nào được tìm thấy!&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="Tìm và Đóng CIF WAY4">
            <stringProp name="HTTPSampler.domain">113.161.76.226</stringProp>
            <stringProp name="HTTPSampler.port">8087</stringProp>
            <stringProp name="HTTPSampler.protocol">http</stringProp>
            <stringProp name="HTTPSampler.path">/hdb-lead-card-management/api/client/get_client_by_identity_card_number?idCard=${idNumberOnboard}</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">GET</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">false</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="User Defined Variables">
              <collectionProp name="Arguments.arguments"/>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">log.info(&quot; \n ---------- SEARCH CARD WAY4 AND DELETE ----------&quot;);

import groovy.json.JsonSlurper;
import org.apache.jmeter.samplers.SampleResult;
import org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy;
import org.apache.jmeter.protocol.http.control.HeaderManager;
import org.apache.jmeter.protocol.http.control.Header;
import org.apache.jmeter.threads.JMeterContext;


// ✅ Lấy thông tin từ request trước đó
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);

// ✅ Lấy response JSON từ request trước đó
def response = prev.getResponseDataAsString().trim();
def jsonSlurper = new JsonSlurper();
def jsonResponse;

// ✅ Parse JSON an toàn
try {
    jsonResponse = jsonSlurper.parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Kiểm tra nếu có dữ liệu `way4Clients` trong response
if (jsonResponse?.way4Clients?.size() &gt; 0) {
    def clientIds = jsonResponse.way4Clients.collect { it.id };
    vars.put(&quot;clientIds&quot;, clientIds.join(&quot;,&quot;)); // Lưu danh sách clientId vào biến JMeter
    
    log.info(&quot;🔹 Danh sách clientIds đã trích xuất: &quot; + clientIds);

    // ✅ Gửi yêu cầu DELETE từng clientId
    clientIds.each { clientId -&gt;
        log.info(&quot;🛑 Đang gửi yêu cầu xóa clientId: &quot; + clientId);
        
        // ✅ Tạo HTTP Sampler cho từng request DELETE
        def sampler = new HTTPSamplerProxy();
        sampler.setDomain(&quot;113.161.76.226&quot;);
        sampler.setPort(8087);
        sampler.setProtocol(&quot;http&quot;);
        sampler.setPath(&quot;/hdb-lead-card-management/api/client/close_way4_cif?clientId=&quot; + clientId);
        sampler.setMethod(&quot;DELETE&quot;);

        // ✅ Thiết lập Header Manager
        def headerManager = new HeaderManager();
        headerManager.add(new Header(&quot;x-api-key&quot;, &quot;szt995RHr033WwY616SWj831YAS346bK&quot;));
        sampler.setHeaderManager(headerManager);

        // ✅ Gửi request bằng SampleResult
        def sampleResult = sampler.sample();
        
        // ✅ Ghi log kết quả
        log.info(&quot; Request: DELETE clientId: &quot; + clientId);
        log.info(&quot; Response Code: &quot; + sampleResult.getResponseCode());
        log.info(&quot; Response Message: &quot; + sampleResult.getResponseMessage());

        if (sampleResult.getResponseCode() != &quot;200&quot;) {
            log.warn(&quot;❌ Lỗi khi xóa clientId: &quot; + clientId + &quot; | Response: &quot; + sampleResult.getResponseDataAsString());
        } else {
            log.info(&quot;✅ Đã xóa thành công clientId: &quot; + clientId);
        }
    }
} else {
    log.warn(&quot;✅ Không có client-ID nào trong way4Clients!&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">x-api-key</stringProp>
                  <stringProp name="Header.value">szt995RHr033WwY616SWj831YAS346bK</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
          </hashTree>
        </hashTree>
        <IfController guiclass="IfControllerPanel" testclass="IfController" testname="1. Check and Clear Account" enabled="true">
          <stringProp name="IfController.condition">${__groovy(vars.get(&quot;phoneNumberOnboard&quot;) != null)}</stringProp>
          <boolProp name="IfController.evaluateAll">false</boolProp>
          <boolProp name="IfController.useExpression">true</boolProp>
        </IfController>
        <hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="1.1 Check ID Number Prospect">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v2/prospect/internal/lookup</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;type&quot;: &quot;national_id&quot;,&#xd;
    &quot;value&quot;: &quot;${idNumberOnboard}&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CHECK ID NUMBER PROSPECT ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage(), e);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất phoneNumber từ payload
def phoneNumberOldFromIdNumberProspect = jsonResponse?.payload?.phoneNumber ?: null

if (phoneNumberOldFromIdNumberProspect) {
    vars.put(&quot;phoneNumberOldFromIdNumberProspect&quot;, phoneNumberOldFromIdNumberProspect.toString());
    log.info(&quot;✅ Prospect phone number found: &quot; + phoneNumberOldFromIdNumberProspect);
} else {
    log.info(&quot;✅ ID Number prospect not found.&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="1.3 Check ID Number Party">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/api/party-service/v2/admin/parties/lookup</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;type&quot;: &quot;national_id&quot;,&#xd;
    &quot;value&quot;: &quot;${idNumberOnboard}&quot;,&#xd;
    &quot;queryParams&quot;: [&quot;cif&quot;]&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">dcb51815-7759-41d8-8fd6-46b32e241acf</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="baggage" elementType="Header">
                  <stringProp name="Header.name">baggage</stringProp>
                  <stringProp name="Header.value">sentry-environment=uat,sentry-transaction=StartupScreen,sentry-public_key=a8650128baf78c0abc77876f8736238f,sentry-trace_id=ae79a0eed0354e439ab2d6820a04d617,sentry-sample_rate=0.85</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="sentry-trace" elementType="Header">
                  <stringProp name="Header.name">sentry-trace</stringProp>
                  <stringProp name="Header.value">ae79a0eed0354e439ab2d6820a04d617-ae34fb51315f7476-1</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${adminKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CHECK ID NUMBER PARTY ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code là 400, đánh dấu request thành công và log cảnh báo
if (responseCode == &quot;400&quot;) {
    prev.setResponseOK(); // Đánh dấu request thành công
    log.warn(&quot;⚠️ Not Found ID Number Party (Response 400).&quot;);
    return;
}

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage(), e);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất trạng thái tài khoản và CIF từ payload
try {
    def statusAccount = jsonResponse?.payload?.status ?: &quot;UNKNOWN&quot;;
    vars.put(&quot;statusAccount&quot;, statusAccount);
    log.info(&quot;✅ Status Account: &quot; + statusAccount);

    def cifNumberOld = jsonResponse?.payload?.cif ?: &quot;N/A&quot;;
    vars.put(&quot;cifNumberOld&quot;, cifNumberOld);
    log.info(&quot;✅ CIF Account Old: &quot; + cifNumberOld);

    log.info(&quot;✅ ID Number Party found successfully!&quot;);
} catch (Exception e) {
    log.warn(&quot;⚠️ Not Found ID Number Party: &quot; + e.getMessage());
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <IfController guiclass="IfControllerPanel" testclass="IfController" testname="1.4 Check Status Account from ID Number  Party" enabled="true">
            <stringProp name="IfController.condition">${__groovy(vars.get(&apos;statusAccount&apos;) == &apos;Active&apos;)}</stringProp>
            <boolProp name="IfController.evaluateAll">false</boolProp>
            <boolProp name="IfController.useExpression">true</boolProp>
          </IfController>
          <hashTree>
            <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="1.4.1 Clear Party from ID Number  Party" enabled="true">
              <stringProp name="HTTPSampler.path">/api/party-service/v2/admin/parties/deactivate-customer</stringProp>
              <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
              <stringProp name="HTTPSampler.method">PATCH</stringProp>
              <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
              <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
              <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                <collectionProp name="Arguments.arguments">
                  <elementProp name="" elementType="HTTPArgument">
                    <boolProp name="HTTPArgument.always_encode">false</boolProp>
                    <stringProp name="Argument.value">{&#xd;
    &quot;customerCifNumber&quot;: &quot;${cifNumberOld}&quot;&#xd;
}</stringProp>
                    <stringProp name="Argument.metadata">=</stringProp>
                  </elementProp>
                </collectionProp>
              </elementProp>
            </HTTPSamplerProxy>
            <hashTree>
              <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
                <collectionProp name="HeaderManager.headers">
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name"></stringProp>
                    <stringProp name="Header.value"></stringProp>
                  </elementProp>
                  <elementProp name="Content-Type" elementType="Header">
                    <stringProp name="Header.name">Content-Type</stringProp>
                    <stringProp name="Header.value">application/json</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">X-KEY</stringProp>
                    <stringProp name="Header.value">${adminKey}</stringProp>
                  </elementProp>
                </collectionProp>
              </HeaderManager>
              <hashTree/>
              <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
                <stringProp name="scriptLanguage">groovy</stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="cacheKey">true</stringProp>
                <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CLEAR PARTY FROM ID NUMBER PARTY ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);

// ✅ Nếu response code là 400, đánh dấu request thành công và log cảnh báo
if (responseCode == &quot;400&quot;) {
    prev.setResponseOK(); // Đánh dấu request thành công
    log.warn(&quot;⚠️ Not Found ID Number Party (Response 400).&quot;);
    return;
}

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    return;
}

// ✅ Nếu API thành công, chỉ log kết quả mà không cần hiển thị response đầy đủ
log.info(&quot;✅ Clear cifNumber of ID Number in Party Success!&quot;);</stringProp>
              </JSR223PostProcessor>
              <hashTree/>
            </hashTree>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="1.5 Check Phone Number Prospect" enabled="true">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v2/prospect</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;phoneNumber&quot;: &quot;+84${phoneNumberOnboard}&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">dcb51815-7759-41d8-8fd6-46b32e241acf</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CHECK PHONE NUMBER PROSPECT ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code là 400, đánh dấu request thành công và log cảnh báo
if (responseCode == &quot;400&quot;) {
    prev.setResponseOK(); // Đánh dấu request thành công
    log.warn(&quot;⚠️ Not Found Prospect from Phone Number Prospect (Response 400).&quot;);
    return;
}

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage(), e);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất prospectId từ payload
def prospectIdPhoneNumberProspect = jsonResponse?.payload?.prospectId ?: null;

if (prospectIdPhoneNumberProspect) {
    vars.put(&quot;prospectIdPhoneNumberProspect&quot;, prospectIdPhoneNumberProspect.toString());
    log.info(&quot;✅ Prospect ID extracted from phone number: &quot; + prospectIdPhoneNumberProspect);
} else {
    log.warn(&quot;✅️ Not Found Prospect from Phone Number Prospect.&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <IfController guiclass="IfControllerPanel" testclass="IfController" testname="1.6 Check Prospect from Phone Number and clear" enabled="true">
            <stringProp name="IfController.condition">${__groovy(vars.get(&quot;prospectIdPhoneNumberProspect&quot;) != null )}</stringProp>
            <boolProp name="IfController.evaluateAll">false</boolProp>
            <boolProp name="IfController.useExpression">true</boolProp>
          </IfController>
          <hashTree>
            <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="1.6.1 Clear Prospect  from Phone Number Prospect" enabled="true">
              <stringProp name="HTTPSampler.path">/v2/onboarding/admin/prospect/${prospectIdPhoneNumberProspect}/clean-prospect</stringProp>
              <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
              <stringProp name="HTTPSampler.method">POST</stringProp>
              <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
              <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
              <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                <collectionProp name="Arguments.arguments">
                  <elementProp name="" elementType="HTTPArgument">
                    <boolProp name="HTTPArgument.always_encode">false</boolProp>
                    <stringProp name="Argument.value">{&#xd;
  &quot;removeAllFaces&quot;: true&#xd;
}</stringProp>
                    <stringProp name="Argument.metadata">=</stringProp>
                  </elementProp>
                </collectionProp>
              </elementProp>
            </HTTPSamplerProxy>
            <hashTree>
              <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
                <collectionProp name="HeaderManager.headers">
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">Content-Type</stringProp>
                    <stringProp name="Header.value">application/json</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">X-KEY</stringProp>
                    <stringProp name="Header.value">${adminKey}</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">secret-key</stringProp>
                    <stringProp name="Header.value">izyMW6MEhhjN0KQfjyb11DwM9XuJyYU6</stringProp>
                  </elementProp>
                </collectionProp>
              </HeaderManager>
              <hashTree/>
              <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
                <stringProp name="scriptLanguage">groovy</stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="cacheKey">true</stringProp>
                <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CLEAR PROSPECT FROM PHONE NUMBER PROSPECT ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code là 400, đánh dấu request thành công và log cảnh báo
if (responseCode == &quot;400&quot;) {
    prev.setResponseOK(); // Đánh dấu request thành công
    log.warn(&quot;⚠️ Not Found Prospect from Phone Number Prospect (Response 400).&quot;);
    return;
}

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    return;
}

// ✅ Nếu API thành công, chỉ log kết quả mà không cần hiển thị response đầy đủ
log.info(&quot;✅ Clear Prospect from Phone Number Prospect Success!&quot;);</stringProp>
              </JSR223PostProcessor>
              <hashTree/>
            </hashTree>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="1.7 Check Phone Number Party" enabled="true">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/api/party-service/v2/admin/parties/lookup</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;type&quot;: &quot;onboard_phone_number&quot;,&#xd;
    &quot;value&quot;: &quot;+84${phoneNumberOnboard}&quot;,&#xd;
    &quot;queryParams&quot;: [&quot;cif&quot;]&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">dcb51815-7759-41d8-8fd6-46b32e241acf</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="baggage" elementType="Header">
                  <stringProp name="Header.name">baggage</stringProp>
                  <stringProp name="Header.value">sentry-environment=uat,sentry-transaction=StartupScreen,sentry-public_key=a8650128baf78c0abc77876f8736238f,sentry-trace_id=ae79a0eed0354e439ab2d6820a04d617,sentry-sample_rate=0.85</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="sentry-trace" elementType="Header">
                  <stringProp name="Header.name">sentry-trace</stringProp>
                  <stringProp name="Header.value">ae79a0eed0354e439ab2d6820a04d617-ae34fb51315f7476-1</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${adminKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CHECK PHONE NUMBER PARTY ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code là 400, đánh dấu request thành công và log cảnh báo
if (responseCode == &quot;400&quot;) {
    prev.setResponseOK(); // Đánh dấu request thành công
    log.warn(&quot;⚠️ Not Found Phone Number Party (Response 400).&quot;);
    return;
}

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage(), e);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất trạng thái tài khoản và CIF từ payload
try {
    def statusAccount = jsonResponse?.payload?.status ?: &quot;UNKNOWN&quot;;
    vars.put(&quot;statusAccount&quot;, statusAccount);
    log.info(&quot;✅ Status Account: &quot; + statusAccount);

    def cifNumberOld = jsonResponse?.payload?.cif ?: &quot;N/A&quot;;
    vars.put(&quot;cifNumberOld&quot;, cifNumberOld);
    log.info(&quot;✅ CIF Account Old: &quot; + cifNumberOld);

    log.info(&quot;✅ Phone Number Party found successfully!&quot;);
} catch (Exception e) {
    log.warn(&quot;⚠️ Not Found Phone Number Party: &quot; + e.getMessage());
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <IfController guiclass="IfControllerPanel" testclass="IfController" testname="1.8 Check Status Account from Phone Number  Party" enabled="true">
            <stringProp name="IfController.condition">${__groovy(vars.get(&apos;statusAccount&apos;) == &apos;Active&apos;)}</stringProp>
            <boolProp name="IfController.evaluateAll">false</boolProp>
            <boolProp name="IfController.useExpression">true</boolProp>
          </IfController>
          <hashTree>
            <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="1.8.1 Clear Party from Phone Number Party" enabled="true">
              <stringProp name="HTTPSampler.path">/api/party-service/v2/admin/parties/deactivate-customer</stringProp>
              <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
              <stringProp name="HTTPSampler.method">PATCH</stringProp>
              <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
              <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
              <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                <collectionProp name="Arguments.arguments">
                  <elementProp name="" elementType="HTTPArgument">
                    <boolProp name="HTTPArgument.always_encode">false</boolProp>
                    <stringProp name="Argument.value">{&#xd;
    &quot;customerCifNumber&quot;: &quot;${cifNumberOld}&quot;&#xd;
}</stringProp>
                    <stringProp name="Argument.metadata">=</stringProp>
                  </elementProp>
                </collectionProp>
              </elementProp>
            </HTTPSamplerProxy>
            <hashTree>
              <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
                <collectionProp name="HeaderManager.headers">
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name"></stringProp>
                    <stringProp name="Header.value"></stringProp>
                  </elementProp>
                  <elementProp name="Content-Type" elementType="Header">
                    <stringProp name="Header.name">Content-Type</stringProp>
                    <stringProp name="Header.value">application/json</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">X-KEY</stringProp>
                    <stringProp name="Header.value">${adminKey}</stringProp>
                  </elementProp>
                </collectionProp>
              </HeaderManager>
              <hashTree/>
              <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
                <stringProp name="scriptLanguage">groovy</stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="cacheKey">true</stringProp>
                <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CLEAR PARTY FROM PHONE NUMBER PARTY ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code là 400, đánh dấu request thành công và log cảnh báo
if (responseCode == &quot;400&quot;) {
    prev.setResponseOK(); // Đánh dấu request thành công
    log.warn(&quot;⚠️ Not Found Phone Number Party (Response 400).&quot;);
    return;
}

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    return;
}

// ✅ Nếu API thành công, chỉ log kết quả mà không cần hiển thị response đầy đủ
log.info(&quot;✅ Clear cifNumber of Phone Number in Party Success!&quot;);</stringProp>
              </JSR223PostProcessor>
              <hashTree/>
            </hashTree>
          </hashTree>
        </hashTree>
        <IfController guiclass="IfControllerPanel" testclass="IfController" testname="2. Create new Account">
          <stringProp name="IfController.condition">${__groovy(vars.get(&quot;phoneNumberOnboard&quot;) != null)}</stringProp>
          <boolProp name="IfController.evaluateAll">false</boolProp>
          <boolProp name="IfController.useExpression">true</boolProp>
        </IfController>
        <hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.1 Register Phone">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v3/onboarding/mobile/verify</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{ &#xd;
	&quot;deviceId&quot;: &quot;${deviceId}&quot;,&#xd;
    &quot;languageCode&quot;: &quot;vi&quot;,&#xd;
    &quot;mobileNumber&quot;: {&#xd;
        &quot;number&quot;: &quot;${phoneNumberOnboard}&quot;,&#xd;
        &quot;countryCode&quot;: &quot;+84&quot;&#xd;
     },&#xd;
     &quot;smsFooterString&quot;: &quot;123&quot;,&#xd;
    &quot;rateLimitingToken&quot;: &quot;kuhkh&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">dcb51815-7759-41d8-8fd6-46b32e241acf</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="baggage" elementType="Header">
                  <stringProp name="Header.name">baggage</stringProp>
                  <stringProp name="Header.value">sentry-environment=uat,sentry-transaction=StartupScreen,sentry-public_key=a8650128baf78c0abc77876f8736238f,sentry-trace_id=ae79a0eed0354e439ab2d6820a04d617,sentry-sample_rate=0.85</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="sentry-trace" elementType="Header">
                  <stringProp name="Header.name">sentry-trace</stringProp>
                  <stringProp name="Header.value">ae79a0eed0354e439ab2d6820a04d617-ae34fb51315f7476-1</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="Set Onboarding ID" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- REGISTER PHONE ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất `onboardingId`
def onboardingId = jsonResponse?.payload?.onboardingId ?: null

// ✅ Kiểm tra Onboarding ID
if (onboardingId) {
    vars.put(&quot;onboardingId&quot;, onboardingId);
    log.info(&quot;✅ Onboarding thành công! ID: &quot; + onboardingId);
} else {
    log.error(&quot;❌ Onboarding ID not found!&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
            <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 PreProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">def verCode = UUID.randomUUID().toString()
vars.put(&quot;deviceId&quot;, verCode)
log.info(&quot; \n ------------&gt; Device ID: &quot; + verCode)
</stringProp>
            </JSR223PreProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.2 Verify OTP" enabled="true">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">v3/onboarding/mobile/${onboardingId}/otp/verify</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value"> { &#xd;
    &quot;deviceId&quot;: &quot;${deviceId}&quot;,&#xd;
    &quot;otp&quot;: &quot;112233&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">b7460507-7c47-4931-8921-3497bc6e0e6c</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="Logging Verify OTP" enabled="true">
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- VERIFY OTP ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất `accessToken`
def accessToken = jsonResponse?.payload?.onboardingToken?.accessToken ?: null

// ✅ Kiểm tra Access Token
if (accessToken) {
    vars.put(&quot;accessToken&quot;, accessToken);
    log.info(&quot;✅ OTP xác minh thành công!&quot;);
//    log.info(&quot;Access Token: &quot; + accessToken);
} else {
    log.error(&quot;❌ Access Token not found!&quot;);
}</stringProp>
              <stringProp name="scriptLanguage">groovy</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.3 Set Resume Point" enabled="true">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v4/onboarding/kyc/set-resume-point</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">PUT</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
	&quot;resumePoint&quot;: &quot;SELFIE&quot;,&#xd;
	&quot;appVersion&quot;: &quot;1.0.0&quot;,&#xd;
	&quot;data&quot;: &quot;&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">OBD-Authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="Logging Resume point" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- SET RESUME POINT ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Nếu thành công, log kết quả
log.info(&quot;✅ Resume Point xử lý thành công!&quot;);</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.4 [MOCK] Hyperverge OCR">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.domain">wiremock.sit.galaxyfinx.in</stringProp>
            <stringProp name="HTTPSampler.protocol">https</stringProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">__admin/mappings/${hpvOcrMockingId}</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">PUT</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;name&quot;: &quot;jmeter-hyperverge-mocking-conghoang-qa&quot;,&#xd;
    &quot;persistent&quot;: true,&#xd;
    &quot;request&quot;: {&#xd;
        &quot;urlPath&quot;: &quot;/hyperverge/v1/link-kyc/results&quot;,&#xd;
        &quot;method&quot;: &quot;POST&quot;,&#xd;
        &quot;bodyPatterns&quot;: [&#xd;
            {&#xd;
                &quot;matchesJsonPath&quot;: &quot;$[?(@.transactionId == &apos;${onboardingId}&apos;)]&quot;&#xd;
            }&#xd;
        ]&#xd;
    },&#xd;
    &quot;response&quot;: {&#xd;
        &quot;status&quot;: 200,&#xd;
        &quot;jsonBody&quot;: {&#xd;
            &quot;status&quot;: &quot;success&quot;,&#xd;
            &quot;statusCode&quot;: 200,&#xd;
            &quot;metadata&quot;: {&#xd;
                &quot;requestId&quot;: &quot;1741245835967-bd36928e-163a-4a1d-b726-596bbb137aa9&quot;,&#xd;
                &quot;transactionId&quot;: &quot;1347105916872294400&quot;&#xd;
            },&#xd;
            &quot;result&quot;: {&#xd;
                &quot;workflowDetails&quot;: {&#xd;
                    &quot;workflowId&quot;: &quot;document_verification&quot;,&#xd;
                    &quot;version&quot;: 1&#xd;
                },&#xd;
                &quot;applicationStatus&quot;: &quot;auto_approved&quot;,&#xd;
                &quot;results&quot;: [&#xd;
                    {&#xd;
                        &quot;module&quot;: &quot;&quot;,&#xd;
                        &quot;countrySelected&quot;: &quot;vnm&quot;,&#xd;
                        &quot;documentSelected&quot;: &quot;id&quot;,&#xd;
                        &quot;attempts&quot;: &quot;1&quot;,&#xd;
                        &quot;expectedDocumentSide&quot;: &quot;front&quot;,&#xd;
                        &quot;moduleId&quot;: &quot;id_card_validation&quot;,&#xd;
                        &quot;croppedImageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-font.png&quot;,&#xd;
                        &quot;imageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-font.png&quot;,&#xd;
                        &quot;apiResponse&quot;: {&#xd;
                            &quot;status&quot;: &quot;success&quot;,&#xd;
                            &quot;statusCode&quot;: 200,&#xd;
                            &quot;metadata&quot;: {&#xd;
                                &quot;requestId&quot;: &quot;1741245508225-f5875b2d-8bd3-4b20-ae37-d24fd49835bb&quot;,&#xd;
                                &quot;transactionId&quot;: &quot;1347105916872294400&quot;&#xd;
                            },&#xd;
                            &quot;result&quot;: {&#xd;
                                &quot;details&quot;: [&#xd;
                                    {&#xd;
                                        &quot;idType&quot;: &quot;cccd_chip_front&quot;,&#xd;
                                        &quot;fieldsExtracted&quot;: {&#xd;
                                            &quot;firstName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;middleName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;lastName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;fullName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;HOÀNG CHÍ CÔNG&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;dateOfBirth&quot;: {&#xd;
                                                &quot;value&quot;: &quot;20-10-1998&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;dateOfIssue&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;dateOfExpiry&quot;: {&#xd;
                                                &quot;value&quot;: &quot;20-10-2038&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;countryCode&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;type&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;address&quot;: {&#xd;
                                                &quot;value&quot;: &quot;Đội 9, Thôn Nghĩa Xuy Xá, Mỹ Đức, Hà Nội&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100,&#xd;
                                                &quot;additionalInfo&quot;: &quot;thn ngha xuy x m c h ni&quot;,&#xd;
                                                &quot;street&quot;: &quot;ĐỘI 9&quot;,&#xd;
                                                &quot;houseNumber&quot;: &quot;&quot;,&#xd;
                                                &quot;district&quot;: &quot;HUYỆN MỸ ĐỨC&quot;,&#xd;
                                                &quot;province&quot;: &quot;THÀNH PHỐ HÀ NỘI&quot;,&#xd;
                                                &quot;zipCode&quot;: &quot;&quot;&#xd;
                                            },&#xd;
                                            &quot;gender&quot;: {&#xd;
                                                &quot;value&quot;: &quot;M&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;idNumber&quot;: {&#xd;
                                                &quot;value&quot;: &quot;${idNumberOnboard}&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;placeOfBirth&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;placeOfIssue&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;yearOfBirth&quot;: {&#xd;
                                                &quot;value&quot;: &quot;1998&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;age&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;fatherName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;motherName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;husbandName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;spouseName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;nationality&quot;: {&#xd;
                                                &quot;value&quot;: &quot;Việt Nam&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;mrzString&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;idNumber&quot;: &quot;&quot;,&#xd;
                                                &quot;fullName&quot;: &quot;&quot;,&#xd;
                                                &quot;gender&quot;: &quot;&quot;,&#xd;
                                                &quot;dateOfBirth&quot;: &quot;&quot;,&#xd;
                                                &quot;dateOfExpiry&quot;: &quot;&quot;,&#xd;
                                                &quot;nationality&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;homeTown&quot;: {&#xd;
                                                &quot;value&quot;: &quot;Xuy Xá, Mỹ Đức, Hà Nội&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            }&#xd;
                                        },&#xd;
                                        &quot;croppedImageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-font.png&quot;,&#xd;
                                        &quot;isWrongSide&quot;: &quot;no&quot;,&#xd;
                                        &quot;qualityChecks&quot;: {&#xd;
                                            &quot;blur&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 100,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;glare&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 10,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;blackAndWhite&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 100,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;partialId&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 97,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;faceNotDetected&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 99,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            }&#xd;
                                        },&#xd;
                                        &quot;tamperChecks&quot;: {&#xd;
                                            &quot;photoTampered&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            }&#xd;
                                        },&#xd;
                                        &quot;ruleChecks&quot;: {&#xd;
                                            &quot;idNumberLengthMismatch&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;expiredID&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;idProvinceCodeInvalid&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;idDOBGenderCodeInvalid&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            }&#xd;
                                        }&#xd;
                                    }&#xd;
                                ],&#xd;
                                &quot;summary&quot;: {&#xd;
                                    &quot;action&quot;: &quot;pass&quot;,&#xd;
                                    &quot;details&quot;: []&#xd;
                                }&#xd;
                            }&#xd;
                        },&#xd;
                        &quot;previousAttempts&quot;: []&#xd;
                    },&#xd;
                    {&#xd;
                        &quot;module&quot;: &quot;&quot;,&#xd;
                        &quot;countrySelected&quot;: &quot;vnm&quot;,&#xd;
                        &quot;documentSelected&quot;: &quot;id&quot;,&#xd;
                        &quot;attempts&quot;: &quot;1&quot;,&#xd;
                        &quot;expectedDocumentSide&quot;: &quot;back&quot;,&#xd;
                        &quot;moduleId&quot;: &quot;id_card_validation&quot;,&#xd;
                        &quot;croppedImageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-back.png&quot;,&#xd;
                        &quot;imageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-back.png&quot;,&#xd;
                        &quot;apiResponse&quot;: {&#xd;
                            &quot;status&quot;: &quot;success&quot;,&#xd;
                            &quot;statusCode&quot;: 200,&#xd;
                            &quot;metadata&quot;: {&#xd;
                                &quot;requestId&quot;: &quot;1741245516494-7669c7ce-5ecf-4753-9037-a4d1f117d069&quot;,&#xd;
                                &quot;transactionId&quot;: &quot;1347105916872294400&quot;&#xd;
                            },&#xd;
                            &quot;result&quot;: {&#xd;
                                &quot;details&quot;: [&#xd;
                                    {&#xd;
                                        &quot;idType&quot;: &quot;cccd_chip_back&quot;,&#xd;
                                        &quot;fieldsExtracted&quot;: {&#xd;
                                            &quot;firstName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;middleName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;lastName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;fullName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;dateOfBirth&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;dateOfIssue&quot;: {&#xd;
                                                &quot;value&quot;: &quot;03-07-2023&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100&#xd;
                                            },&#xd;
                                            &quot;dateOfExpiry&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;countryCode&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;type&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;address&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;additionalInfo&quot;: &quot;&quot;,&#xd;
                                                &quot;street&quot;: &quot;&quot;,&#xd;
                                                &quot;houseNumber&quot;: &quot;&quot;,&#xd;
                                                &quot;district&quot;: &quot;&quot;,&#xd;
                                                &quot;province&quot;: &quot;&quot;,&#xd;
                                                &quot;zipCode&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;gender&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;idNumber&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;placeOfBirth&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;placeOfIssue&quot;: {&#xd;
                                                &quot;value&quot;: &quot;CỤC TRƯỞNG CỤC CẢNH SÁT QUẢN LÝ HÀNH CHÍNH VỀ TRẬT TỰ XÃ HỘI&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 95&#xd;
                                            },&#xd;
                                            &quot;yearOfBirth&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;age&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;fatherName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;motherName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;husbandName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;spouseName&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;nationality&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;mrzString&quot;: {&#xd;
                                                &quot;value&quot;: &quot;IDVNM0980341588001098034158&lt;&lt;99810204M3810202VNM&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;8HOANG&lt;&lt;CHI&lt;CONG&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                                &quot;score&quot;: 100,&#xd;
                                                &quot;idNumber&quot;: &quot;001098034158&quot;,&#xd;
                                                &quot;fullName&quot;: &quot;HOANG CHI CONG&quot;,&#xd;
                                                &quot;gender&quot;: &quot;M&quot;,&#xd;
                                                &quot;dateOfBirth&quot;: &quot;20-10-1998&quot;,&#xd;
                                                &quot;dateOfExpiry&quot;: &quot;20-10-2038&quot;,&#xd;
                                                &quot;nationality&quot;: &quot;VNM&quot;&#xd;
                                            },&#xd;
                                            &quot;homeTown&quot;: {&#xd;
                                                &quot;value&quot;: &quot;&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            }&#xd;
                                        },&#xd;
                                        &quot;croppedImageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-back.png&quot;,&#xd;
                                        &quot;isWrongSide&quot;: &quot;no&quot;,&#xd;
                                        &quot;qualityChecks&quot;: {&#xd;
                                            &quot;blur&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 100,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;glare&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 10,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;blackAndWhite&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 100,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            },&#xd;
                                            &quot;partialId&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 97,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            }&#xd;
                                        },&#xd;
                                        &quot;ruleChecks&quot;: {&#xd;
                                            &quot;mrzTampered&quot;: {&#xd;
                                                &quot;value&quot;: &quot;no&quot;,&#xd;
                                                &quot;score&quot;: 0,&#xd;
                                                &quot;confidence&quot;: &quot;high&quot;&#xd;
                                            }&#xd;
                                        }&#xd;
                                    }&#xd;
                                ],&#xd;
                                &quot;summary&quot;: {&#xd;
                                    &quot;action&quot;: &quot;pass&quot;,&#xd;
                                    &quot;details&quot;: []&#xd;
                                }&#xd;
                            }&#xd;
                        },&#xd;
                        &quot;previousAttempts&quot;: []&#xd;
                    },&#xd;
                    {&#xd;
                        &quot;module&quot;: &quot;&quot;,&#xd;
                        &quot;attempts&quot;: &quot;1&quot;,&#xd;
                        &quot;moduleId&quot;: &quot;module_selfie&quot;,&#xd;
                        &quot;imageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-selfie.png&quot;,&#xd;
                        &quot;apiResponse&quot;: {&#xd;
                            &quot;status&quot;: &quot;success&quot;,&#xd;
                            &quot;statusCode&quot;: 200,&#xd;
                            &quot;metadata&quot;: {&#xd;
                                &quot;requestId&quot;: &quot;1741245530617-3d74f53e-bd43-4f3c-940a-a248ee29e92f&quot;,&#xd;
                                &quot;transactionId&quot;: &quot;1347105916872294400&quot;&#xd;
                            },&#xd;
                            &quot;result&quot;: {&#xd;
                                &quot;details&quot;: {&#xd;
                                    &quot;liveFace&quot;: {&#xd;
                                        &quot;value&quot;: &quot;yes&quot;,&#xd;
                                        &quot;confidence&quot;: &quot;high&quot;,&#xd;
                                        &quot;score&quot;: 100&#xd;
                                    },&#xd;
                                    &quot;qualityChecks&quot;: {&#xd;
                                        &quot;blur&quot;: {&#xd;
                                            &quot;score&quot;: 94,&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;eyesClosed&quot;: {&#xd;
                                            &quot;score&quot;: 0,&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;eyewear&quot;: {&#xd;
                                            &quot;score&quot;: 0,&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;faceOccluded&quot;: {&#xd;
                                            &quot;score&quot;: 0,&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;hat&quot;: {&#xd;
                                            &quot;score&quot;: 99,&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;headTurned&quot;: {&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;score&quot;: 0,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;maskPresent&quot;: {&#xd;
                                            &quot;score&quot;: 0,&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;multipleFaces&quot;: {&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;score&quot;: 0,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        },&#xd;
                                        &quot;nudity&quot;: {&#xd;
                                            &quot;score&quot;: 100,&#xd;
                                            &quot;value&quot;: &quot;no&quot;,&#xd;
                                            &quot;confidence&quot;: &quot;high&quot;&#xd;
                                        }&#xd;
                                    }&#xd;
                                },&#xd;
                                &quot;summary&quot;: {&#xd;
                                    &quot;action&quot;: &quot;pass&quot;,&#xd;
                                    &quot;details&quot;: []&#xd;
                                }&#xd;
                            }&#xd;
                        },&#xd;
                        &quot;previousAttempts&quot;: []&#xd;
                    },&#xd;
                    {&#xd;
                        &quot;module&quot;: &quot;&quot;,&#xd;
                        &quot;moduleId&quot;: &quot;module_facematch&quot;,&#xd;
                        &quot;idImageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-font.png&quot;,&#xd;
                        &quot;selfieImageUrl&quot;: &quot;https://wiremock.sit.galaxyfinx.in/conghoangqa/conghoang-selfie.png&quot;,&#xd;
                        &quot;apiResponse&quot;: {&#xd;
                            &quot;status&quot;: &quot;success&quot;,&#xd;
                            &quot;statusCode&quot;: 200,&#xd;
                            &quot;metadata&quot;: {&#xd;
                                &quot;requestId&quot;: &quot;1741245532444-3dc2f35a-094d-42bc-a00d-09535c09f1d5&quot;,&#xd;
                                &quot;transactionId&quot;: &quot;1347105916872294400&quot;&#xd;
                            },&#xd;
                            &quot;result&quot;: {&#xd;
                                &quot;details&quot;: {&#xd;
                                    &quot;match&quot;: {&#xd;
                                        &quot;value&quot;: &quot;yes&quot;,&#xd;
                                        &quot;score&quot;: 99,&#xd;
                                        &quot;confidence&quot;: &quot;high&quot;&#xd;
                                    }&#xd;
                                },&#xd;
                                &quot;summary&quot;: {&#xd;
                                    &quot;action&quot;: &quot;pass&quot;,&#xd;
                                    &quot;details&quot;: []&#xd;
                                }&#xd;
                            }&#xd;
                        },&#xd;
                        &quot;attempts&quot;: &quot;1&quot;,&#xd;
                        &quot;previousAttempts&quot;: []&#xd;
                    }&#xd;
                ],&#xd;
                &quot;userDetails&quot;: {&#xd;
                    &quot;facematchAction&quot;: &quot;pass&quot;,&#xd;
                    &quot;selfieRequestId&quot;: &quot;1741245530617-3d74f53e-bd43-4f3c-940a-a248ee29e92f&quot;,&#xd;
                    &quot;facematchRequestId&quot;: &quot;1741245532444-3dc2f35a-094d-42bc-a00d-09535c09f1d5&quot;,&#xd;
                    &quot;selfieAction&quot;: &quot;pass&quot;&#xd;
                }&#xd;
            }&#xd;
        },&#xd;
        &quot;headers&quot;: {&#xd;
            &quot;Content-Type&quot;: &quot;application/json&quot;&#xd;
        },&#xd;
        &quot;transformers&quot;: [&#xd;
            &quot;response-template&quot;&#xd;
        ]&#xd;
    },&#xd;
    &quot;priority&quot;: 2,&#xd;
    &quot;metadata&quot;: {&#xd;
        &quot;wiremock-gui&quot;: {&#xd;
            &quot;folder&quot;: &quot;/mappings/hyperverge/jmeter&quot;&#xd;
        }&#xd;
    }&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 PreProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">log.info(&quot;-----[MOCK] Hyperverge OCR-----&quot;);

//def digits = Long.toString(${phoneNumberOnboard});
//def CCCD = &quot;044091&quot; + digits[-6..-1]
//vars.put(&quot;idNumber&quot;, CCCD)
//log.info(&quot; \n ------------------&gt; id number: &quot; + CCCD);</stringProp>
            </JSR223PreProcessor>
            <hashTree/>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">OBD-Authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- [MOCK] HYPERVEGER OCR ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất `idHyperVergeOCR`
def idHyperVergeOCR = jsonResponse?.id ?: null

// ✅ Kiểm tra idHyperVergeOCR
if (idHyperVergeOCR) {
    vars.put(&quot;idHyperVergeOCR&quot;, idHyperVergeOCR);
    log.info(&quot;✅ idHyperVergeOCR Extracted: &quot; + idHyperVergeOCR);
} else {
    log.error(&quot;❌ idHyperVergeOCR not found!&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.5 [MOCK] HDB biometric">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.domain">wiremock.sit.galaxyfinx.in</stringProp>
            <stringProp name="HTTPSampler.protocol">https</stringProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">__admin/mappings/${hdbBiometricMockingId}</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">PUT</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;name&quot;: &quot;jmeter-hdb-biometric-conghoang-qa&quot;,&#xd;
    &quot;persistent&quot;: true,&#xd;
    &quot;request&quot;: {&#xd;
        &quot;url&quot;: &quot;/hdb-biometric/face-service/v1/customer/list-filter?card_id=${idNumberOnboard}&quot;,&#xd;
        &quot;method&quot;: &quot;GET&quot;&#xd;
    },&#xd;
    &quot;response&quot;: {&#xd;
        &quot;status&quot;: 200,&#xd;
        &quot;jsonBody&quot;: {&#xd;
            &quot;transaction_id&quot;: &quot;8d9a9001-ef40-42d0-8b23-18b78480aedc&quot;,&#xd;
            &quot;log_id&quot;: &quot;d01993c9-e531-11ef-bed5-f7acacfcb782-c067f8e2-apigateway-service-84d657594f-6q4gb&quot;,&#xd;
            &quot;data_base64&quot;: &quot;eyJ0cmFuc2FjdGlvbl9pZCI6IjhkOWE5MDAxLWVmNDAtNDJkMC04YjIzLTE4Yjc4NDgwYWVkYyIsImxvZ19pZCI6ImQwMTk5M2M5LWU1MzEtMTFlZi1iZWQ1LWY3YWNhY2ZjYjc4Mi1jMDY3ZjhlMi1hcGlnYXRld2F5LXNlcnZpY2UtODRkNjU3NTk0Zi02cTRnYiIsIm1lc3NhZ2UiOiJJREctMDAwMDAwMDAiLCJvYmplY3QiOnsiY3VzdG9tZXJfZmFjZXMiOlt7ImltYWdlX3VybCI6ImVreWMtY2ljL3Zla3ljdXBsb2FkL2lkZ3YyLXR5cGUzMS1kNjNkOGRiNC0yMzIyLTRmNzYtYjVkZi1iYzQzZDM3YzdjMTMvMjAyNTAxMjMvOTFkODc3MWUtZDk3OC0xMWVmLTk3ZDAtMjllZTFjNzAxODg0LmpwZWciLCJncm91cF9jdXN0b21lciI6IkZhY2Ugc2VsZmllIiwiY2hhbm5lbCI6IlZJS0tJIiwidmVyaWZ5X3N0YXR1cyI6MCwiY3JlYXRlZF9kYXRlIjoiMjMvMDEvMjAyNSAxNzo1NTo0MSIsInN0YXR1cyI6MH0seyJpbWFnZV91cmwiOiJla3ljLWNpYy92ZWt5Y3VwbG9hZC9pZGd2Mi10eXBlMzEtZDYzZDhkYjQtMjMyMi00Zjc2LWI1ZGYtYmM0M2QzN2M3YzEzLzIwMjUwMTIzLzkyY2VlNTBmLWQ5NzgtMTFlZi05N2QwLWM1ZTNlZDEyMmM0NS5qcGVnIiwiZ3JvdXBfY3VzdG9tZXIiOiJGYWNlIGNoaXAiLCJjaGFubmVsIjoiVklLS0kiLCJ2ZXJpZnlfc3RhdHVzIjoxLCJjcmVhdGVkX2RhdGUiOiIyMy8wMS8yMDI1IDE3OjU1OjQxIiwic3RhdHVzIjoxfV0sInV1aWRfY3VzdG9tZXIiOiI5M2UwOWE3OC0yYzc0LTRiNjktYmM5YS04MDVjNmJlYWM3MmUiLCJjdXN0b21lcl9jYXJkcyI6W3sib3JpZ2luX2xvY2F0aW9uIjoiWHV5IFjDoSwgTeG7uSDEkOG7qWMsIEjDoCBO4buZaSIsInJlY2VudF9sb2NhdGlvbiI6IsSQ4buZaSA5LCBUaMO0biBOZ2jEqWEsIFh1eSBYw6EsIE3hu7kgxJDhu6ljLCBIw6AgTuG7mWkiLCJldGhuaWMiOiJLaW5oIiwiZ2VuZGVyIjoiTmFtIiwiZGFkX25hbWUiOiJIb8OgbmcgVsSDbiBDaGnhur9uIiwicmVzdWx0X2MwNiI6eyJzaWduYXR1cmUiOiJLbzI3bE9wdFRZdThUTzZJVlpyUndMZVRiUEpRbzBqZG5jYnFHS05TQnk4aG9Ta1lkM0h5NnV4NVRSK00ycUVZc3lZT2ZNYmlwTTZ0NC9EMlNsK3FxazhGVEJTWGdOQ1ZrTFFiTDNhcFZySld4Ukc0K29TMTRDcXZZOG1lV0RpSmh0Rk8rTmdZSXljb0xTWUkxQ2cxbmJyMnd4MHdOU0lpYWRyY0ZnWUtBeEIzTmw3dHBlQ1NuTXlCS0tVZjZEaXR0U3N6cGlrZkxvK29EbXYvZTFST3VkVlNDRW9nOStTV2YzenJFNnFmRVprSzRld2UydDhiQlFHUzRpYWlGRWp4YXpqbzg5cnBhZDY4WlVIbmhDQXNmQy9XdGlwUW5MeExBMksrUlZ5bFJEQitNNkkrYSs2aFJRbWFmRXYzNHBKVkd4QU9FM2t1aFpwamp5UEppdEFMbXc9PSIsInJlc3BvbmRzIjp7InJlc3VsdCI6dHJ1ZSwicmVzcG9uc2VfaWQiOiJ2bnB0LTAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCIsImV4aXRjb2RlIjowLCJ0aW1lIjowLCJtZXNzYWdlIjoidmFsaWQgaWRjYXJkIiwicmVzcG9uc2VJZCI6InZucHQtMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwIn19LCJyZWxpZ2lvbiI6IkPDtG5nIGdpw6FvIiwiYmlydGhfZGF5IjoiMjAvMTAvMTk5OCIsImZlYXR1cmVzIjoiTuG7kXQgcnXhu5NpIEM6IDJjbSBkxrDhu5tpIHNhdSBtw6lwIHBo4bqjaSIsInZhbGlkX2RhdGUiOiIyMC8xMC8yMDM4Iiwic3BvdXNlX25hbWUiOiIiLCJtcnoiOiJbSURWTk0wOTgwMzQxNTg4MDAxMDk4MDM0MTU4PDw5LCA5ODEwMjA0TTM4MTAyMDJWTk08PDw8PDw8PDw8PDgsIEhPQU5HPDxDSEk8Q09ORzw8PDw8PDw8PDw8PDw8PF0iLCJuYXRpb25hbGl0eSI6IlZp4buHdCBOYW0iLCJpc3N1ZV9kYXRlIjoiMDMvMDcvMjAyMyIsIm5hbWUiOiJIb8OgbmcgQ2jDrSBDw7RuZyIsIm9sZF9pZCI6IjAxNzQ0NjI1NCIsImlkIjoiMDAxMDk4MDM0MTU4IiwibW9tX25hbWUiOiJOZ3V54buFbiBUaOG7iyBTb24ifV19fQ==&quot;,&#xd;
            &quot;data_sign&quot;: &quot;N9A2BpKHpiqvQbDuz2Al2yHcDy+oT/QzBf8LEPMUBrxCdyYtEIZag6mChzcDbon+i1SOgdFj4YOgieWEpyDu/fPdbRJlmcbLjJGjHG3fhlytX/a3JHPA92huwcNbh4EPhangaq0udoaLJKzfqzT73tcWxxjIB2RAqNfDYt+0L+KtX94WpwNyu3kQ+g1OUGtwLUcmHulTTa8p3dpRuzV217Viqccapx2bPDp3XReIjOl1+QWNekvIHbcZFpXPkVrJWH1w6KcB1p3DHtlot3+U0w+V/DWLuaUHg2FZB7CHHsPU/U3BAxwEkHt6IS4bm0i/rxI//h3hJkzQmVSgrhkgGw==&quot;,&#xd;
            &quot;message&quot;: &quot;IDG-00000000&quot;,&#xd;
            &quot;object&quot;: {&#xd;
                &quot;customer_faces&quot;: [&#xd;
                    {&#xd;
                        &quot;image_url&quot;: &quot;ekyc-cic/vekycupload/idgv2-type31-d63d8db4-2322-4f76-b5df-bc43d37c7c13/20250123/91d8771e-d978-11ef-97d0-29ee1c701884.jpeg&quot;,&#xd;
                        &quot;group_customer&quot;: &quot;Face selfie&quot;,&#xd;
                        &quot;channel&quot;: &quot;VIKKI&quot;,&#xd;
                        &quot;verify_status&quot;: 0,&#xd;
                        &quot;created_date&quot;: &quot;23/01/2025 17:55:41&quot;,&#xd;
                        &quot;status&quot;: 0&#xd;
                    },&#xd;
                    {&#xd;
                        &quot;image_url&quot;: &quot;ekyc-cic/vekycupload/idgv2-type31-d63d8db4-2322-4f76-b5df-bc43d37c7c13/20250123/92cee50f-d978-11ef-97d0-c5e3ed122c45.jpeg&quot;,&#xd;
                        &quot;group_customer&quot;: &quot;Face chip&quot;,&#xd;
                        &quot;channel&quot;: &quot;VIKKI&quot;,&#xd;
                        &quot;verify_status&quot;: 1,&#xd;
                        &quot;created_date&quot;: &quot;23/01/2025 17:55:41&quot;,&#xd;
                        &quot;status&quot;: 1&#xd;
                    }&#xd;
                ],&#xd;
                &quot;uuid_customer&quot;: &quot;c163b1a4-e376-46fe-8535-af146e33a118&quot;,&#xd;
                &quot;customer_cards&quot;: [&#xd;
                    {&#xd;
                        &quot;origin_location&quot;: &quot;Xuy Xá, Mỹ Đức, Hà Nội&quot;,&#xd;
                        &quot;recent_location&quot;: &quot;Đội 9, Thôn Nghĩa, Xuy Xá, Mỹ Đức, Hà Nội&quot;,&#xd;
                        &quot;ethnic&quot;: &quot;Kinh&quot;,&#xd;
                        &quot;gender&quot;: &quot;Nam&quot;,&#xd;
                        &quot;dad_name&quot;: &quot;Hoàng Văn Chiến&quot;,&#xd;
                        &quot;result_c06&quot;: {&#xd;
                            &quot;signature&quot;: &quot;Ko27lOptTYu8TO6IVZrRwLeTbPJQo0jdncbqGKNSBy8hoSkYd3Hy6ux5TR+M2qEYsyYOfMbipM6t4/D2Sl+qqk8FTBSXgNCVkLQbL3apVrJWxRG4+oS14CqvY8meWDiJhtFO+NgYIycoLSYI1Cg1nbr2wx0wNSIiadrcFgYKAxB3Nl7tpeCSnMyBKKUf6DittSszpikfLo+oDmv/e1ROudVSCEog9+SWf3zrE6qfEZkK4ewe2t8bBQGS4iaiFEjxazjo89rpad68ZUHnhCAsfC/WtipQnLxLA2K+RVylRDB+M6I+a+6hRQmafEv34pJVGxAOE3kuhZpjjyPJitALmw==&quot;,&#xd;
                            &quot;responds&quot;: {&#xd;
                                &quot;result&quot;: true,&#xd;
                                &quot;response_id&quot;: &quot;vnpt-00000000-0000-0000-0000-000000000000&quot;,&#xd;
                                &quot;exitcode&quot;: 0,&#xd;
                                &quot;time&quot;: 0,&#xd;
                                &quot;message&quot;: &quot;valid idcard&quot;,&#xd;
                                &quot;responseId&quot;: &quot;vnpt-00000000-0000-0000-0000-000000000000&quot;&#xd;
                            }&#xd;
                        },&#xd;
                        &quot;religion&quot;: &quot;Công giáo&quot;,&#xd;
                        &quot;birth_day&quot;: &quot;20/10/1998&quot;,&#xd;
                        &quot;features&quot;: &quot;Nốt ruồi C: 2cm dưới sau mép phải&quot;,&#xd;
                        &quot;valid_date&quot;: &quot;20/10/2038&quot;,&#xd;
                        &quot;spouse_name&quot;: &quot;&quot;,&#xd;
                        &quot;mrz&quot;: &quot;[IDVNM0980341588001098034158&lt;&lt;9, 9810204M3810202VNM&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;8, HOANG&lt;&lt;CHI&lt;CONG&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;]&quot;,&#xd;
                        &quot;nationality&quot;: &quot;Việt Nam&quot;,&#xd;
                        &quot;issue_date&quot;: &quot;03/07/2023&quot;,&#xd;
                        &quot;name&quot;: &quot;Hoàng Chí Công&quot;,&#xd;
                        &quot;old_id&quot;: &quot;017446254&quot;,&#xd;
                        &quot;id&quot;: &quot;${idNumberOnboard}&quot;,&#xd;
                        &quot;mom_name&quot;: &quot;Nguyễn Thị Son&quot;&#xd;
                    }&#xd;
                ]&#xd;
            }&#xd;
        },&#xd;
        &quot;headers&quot;: {&#xd;
            &quot;Content-Type&quot;: &quot;application/json&quot;&#xd;
        },&#xd;
        &quot;transformers&quot;: [&#xd;
            &quot;response-template&quot;&#xd;
        ]&#xd;
    },&#xd;
    &quot;priority&quot;: 2,&#xd;
    &quot;metadata&quot;: {&#xd;
        &quot;wiremock-gui&quot;: {&#xd;
            &quot;folder&quot;: &quot;/mappings/hdb-biometric/jmeter&quot;&#xd;
        }&#xd;
    }&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">OBD-Authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- [MOCK] HDB BIOMETRIC ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất `hdbBiometricMockingId`
def hdbBiometricMockingId = jsonResponse?.id ?: null

// ✅ Kiểm tra hdbBiometricMockingId
if (hdbBiometricMockingId) {
    vars.put(&quot;hdbBiometricMockingId&quot;, hdbBiometricMockingId);
    log.info(&quot;✅ HDB Biometric Mock ID Extracted: &quot; + hdbBiometricMockingId);
} else {
    log.error(&quot;❌ HDB Biometric Mock ID not found!&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.6 Pre check KYC">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v4/onboarding/kyc/pre-check-kyc</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">false</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="User Defined Variables">
              <collectionProp name="Arguments.arguments"/>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">OBD-Authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- PRECHECK KYC ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Log kết quả Precheck KYC
log.info(&quot;✅ Precheck KYC thành công! Response: &quot; + jsonResponse);</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.7 Submit info">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v4/onboarding/kyc/submit-info</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
	&quot;idNumber&quot;: &quot;${idNumberOnboard}&quot;,&#xd;
     &quot;currentAddress&quot;: &quot;Test Address&quot;,&#xd;
	&quot;oldIdNumber&quot;: &quot;123123123&quot;,&#xd;
	&quot;languageCode&quot;: &quot;VI&quot;,&#xd;
	&quot;email&quot; : &quot;api@test.com&quot;,&#xd;
	&quot;isFatca&quot;: false,&#xd;
	&quot;isPep&quot;: false,&#xd;
	&quot;occupationCode&quot;: &quot;OC022&quot;,&#xd;
	&quot;jobPositionCode&quot;: &quot;P001&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">OBD-Authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- SUBMIT INFO ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Log kết quả Submit Info
log.info(&quot;✅ Submit Info thành công! Response: &quot; + jsonResponse);</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.8 Create Password">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v4/onboarding/accountCreation/credential</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value"> { &#xd;
    &quot;password&quot;: &quot;QWJjZDEyMw==&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">x-session-id</stringProp>
                  <stringProp name="Header.value">${sessionId}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">OBD-Authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CREATE PASSWORD ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất `cifNumber`
def cifNumber = jsonResponse?.payload?.cifId ?: null

// ✅ Kiểm tra cifNumber
if (cifNumber) {
    vars.put(&quot;cifNumber&quot;, cifNumber);
    log.info(&quot;✅ Tạo mật khẩu thành công! CIF Number: &quot; + cifNumber);
} else {
    log.error(&quot;❌ CIF NUMBER NOT FOUND!&quot;);
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.9 Check face dedup" enabled="true">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v3/onboarding/kyc/check-face-dedup</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{ &#xd;
    &quot;os&quot;: &quot;IOS&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">x-session-id</stringProp>
                  <stringProp name="Header.value">${sessionId}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">OBD-Authorization</stringProp>
                  <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- TRIGGER FACEDEDUP ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Log kết quả Facededup Trigger
log.info(&quot;✅ Facededup Trigger thành công! Response: &quot; + jsonResponse);</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <WhileController guiclass="WhileControllerGui" testclass="WhileController" testname="2.10 While loop to get KYC status" enabled="true">
            <stringProp name="WhileController.condition">${__groovy(
    def attempts = (vars.get(&quot;attemps&quot;) ?: &quot;0&quot;) as Integer;
    def kycStatus = vars.get(&quot;kycStatus&quot;);
    
    if (kycStatus == &quot;APPROVED&quot;) return false;
    if (attempts &gt;= 20) return false;
    
    return kycStatus == null || 
           kycStatus == &quot;N_A&quot; || 
           kycStatus == &quot;NEEDS_REVIEW&quot;
)}</stringProp>
          </WhileController>
          <hashTree>
            <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="Get KYC status" enabled="true">
              <intProp name="HTTPSampler.concurrentPool">6</intProp>
              <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
              <stringProp name="HTTPSampler.path">/v3/onboarding/kyc/kyc-status-with-details</stringProp>
              <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
              <stringProp name="HTTPSampler.method">GET</stringProp>
              <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
              <boolProp name="HTTPSampler.postBodyRaw">false</boolProp>
              <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="User Defined Variables">
                <collectionProp name="Arguments.arguments"/>
              </elementProp>
            </HTTPSamplerProxy>
            <hashTree>
              <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
                <collectionProp name="HeaderManager.headers">
                  <elementProp name="x-request-id" elementType="Header">
                    <stringProp name="Header.name">x-request-id</stringProp>
                    <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                  </elementProp>
                  <elementProp name="gtw-authorization" elementType="Header">
                    <stringProp name="Header.name">gtw-authorization</stringProp>
                    <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                  </elementProp>
                  <elementProp name="x-open-id" elementType="Header">
                    <stringProp name="Header.name">x-open-id</stringProp>
                    <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                  </elementProp>
                  <elementProp name="Accept-Language" elementType="Header">
                    <stringProp name="Header.name">Accept-Language</stringProp>
                    <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                  </elementProp>
                  <elementProp name="Content-Type" elementType="Header">
                    <stringProp name="Header.name">Content-Type</stringProp>
                    <stringProp name="Header.value">application/json</stringProp>
                  </elementProp>
                  <elementProp name="Accept-Encoding" elementType="Header">
                    <stringProp name="Header.name">Accept-Encoding</stringProp>
                    <stringProp name="Header.value">gzip, deflate, br</stringProp>
                  </elementProp>
                  <elementProp name="User-Agent" elementType="Header">
                    <stringProp name="Header.name">User-Agent</stringProp>
                    <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                  </elementProp>
                  <elementProp name="Accept" elementType="Header">
                    <stringProp name="Header.name">Accept</stringProp>
                    <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">x-session-id</stringProp>
                    <stringProp name="Header.value">${sessionId}</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">OBD-Authorization</stringProp>
                    <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">X-KEY</stringProp>
                    <stringProp name="Header.value">${publicKey}</stringProp>
                  </elementProp>
                </collectionProp>
              </HeaderManager>
              <hashTree/>
              <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
                <stringProp name="scriptLanguage">groovy</stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="cacheKey">true</stringProp>
                <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot;\n---------- CHECKING KYC STATUS ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info(requestUrl + &quot; | Time: &quot; + responseTime + &quot;ms&quot;);

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot;📜 Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot;📜 Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất thông tin KYC
def kycStatus = jsonResponse?.payload?.kycStatus?.trim() ?: &quot;N_A&quot;;
def needsReviewCheck = jsonResponse?.payload?.needsReviewCheck ?: [];
def declinedCheck = jsonResponse?.payload?.declinedCheck ?: [];
def payload = jsonResponse?.payload ?: &quot;N_A&quot;;

// ✅ Lưu giá trị vào biến JMeter
vars.put(&quot;kycStatus&quot;, kycStatus);
vars.put(&quot;needsReviewCheck&quot;, needsReviewCheck ? needsReviewCheck.join(&quot;,&quot;) : &quot;&quot;);
vars.put(&quot;declinedCheck&quot;, declinedCheck ? declinedCheck.join(&quot;,&quot;) : &quot;&quot;);

// ✅ Ghi log Payload, Needs Review Check, Declined Check
log.info(&quot; Payload: &quot; + payload);

// ✅ Xử lý `kycStatus` với `switch-case`
switch (kycStatus) {
    case &quot;APPROVED&quot;:
        vars.put(&quot;isTriggerFinalCheck&quot;, &quot;true&quot;);
        log.info(&quot;✅ KYC is APPROVED - Stopping current loop.&quot;);
        prev.setIgnore(); // Dừng vòng lặp hiện tại
        return;

    case &quot;DECLINED&quot;:
        log.info(&quot;❌ KYC DECLINED! Declined Check Reasons: &quot; + declinedCheck);
        prev.setIgnore();
        return;

    case &quot;NEEDS_REVIEW&quot;:
        log.info(&quot; KYC NEEDS REVIEW: &quot; + needsReviewCheck);
        if (needsReviewCheck.isEmpty()) {
            vars.put(&quot;isTriggerFinalCheck&quot;, &quot;true&quot;);
            log.info(&quot; No further review required. Triggering final check.&quot;);
        }
        break;

    default:
        log.warn(&quot;️ KYC Status: &quot; + kycStatus + &quot; - Continuing review process.&quot;);
}

// ✅ Tăng số lần thử kiểm tra KYC
def attempts = Integer.parseInt(vars.get(&quot;attempts&quot;) ?: &quot;0&quot;) + 1;
vars.put(&quot;attempts&quot;, String.valueOf(attempts));

log.info(&quot; KYC Check Attempt: &quot; + attempts);

// ✅ Tạm dừng trước khi kiểm tra lại
Thread.sleep(2222);</stringProp>
              </JSR223PostProcessor>
              <hashTree/>
            </hashTree>
            <IfController guiclass="IfControllerPanel" testclass="IfController" testname="If needs review" enabled="true">
              <stringProp name="IfController.condition">${__groovy(vars.get(&quot;kycStatus&quot;).equals(&quot;NEEDS_REVIEW&quot;))}</stringProp>
              <boolProp name="IfController.evaluateAll">false</boolProp>
              <boolProp name="IfController.useExpression">true</boolProp>
            </IfController>
            <hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="If is not trigger final check" enabled="true">
                <stringProp name="IfController.condition">${__groovy(vars.get(&quot;isTriggerFinalCheck&quot;) == null)}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="Build manual request" enabled="true">
                  <stringProp name="scriptLanguage">groovy</stringProp>
                  <stringProp name="parameters"></stringProp>
                  <stringProp name="filename"></stringProp>
                  <stringProp name="cacheKey">true</stringProp>
                  <stringProp name="script">import org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy
import org.apache.jmeter.threads.JMeterVariables
import groovy.json.JsonBuilder
import groovy.json.JsonOutput

// ✅ Hiển thị thông tin cập nhật manual review
log.info(&quot;\n---------- UPDATING MANUAL REVIEW ----------&quot;);

// ✅ Lấy giá trị `needsReviewCheck`
def needReviewStr = vars.get(&quot;needsReviewCheck&quot;)?.trim() ?: &quot;&quot;
if (needReviewStr.isEmpty()) {
    log.warn(&quot;⚠️ No checks found for manual review.&quot;);
    return;
}

// ✅ Chia `needsReviewCheck` thành danh sách
def needsReviewChecks = needReviewStr.split(&apos;,&apos;);

// ✅ Ghi log danh sách các review cần kiểm tra
log.info(&quot; Needs Review Checks: &quot; + needsReviewChecks.join(&quot;, &quot;));

// ✅ Xây dựng JSON cho manual update API
def manualUpdateBody = [:];
needsReviewChecks.each { check -&gt;
    manualUpdateBody[check] = &quot;MANUALLY_APPROVED&quot;;
}

// ✅ Chuyển đổi thành JSON đẹp để log
def manualUpdateJson = new JsonBuilder(manualUpdateBody).toPrettyString();
vars.put(&quot;manualUpdateJson&quot;, manualUpdateJson);

// ✅ Ghi log nội dung JSON manual update theo format rõ ràng
log.info(&quot;📜 Manual Update JSON:\n&quot; + JsonOutput.prettyPrint(JsonOutput.toJson(manualUpdateBody)));</stringProp>
                </JSR223PreProcessor>
                <hashTree/>
                <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="Manual Update" enabled="true">
                  <intProp name="HTTPSampler.concurrentPool">6</intProp>
                  <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
                  <stringProp name="HTTPSampler.path">/v3/onboarding/admin/kyc/${onboardingId}/manual-update</stringProp>
                  <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
                  <stringProp name="HTTPSampler.method">PATCH</stringProp>
                  <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
                  <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
                  <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                    <collectionProp name="Arguments.arguments">
                      <elementProp name="" elementType="HTTPArgument">
                        <boolProp name="HTTPArgument.always_encode">false</boolProp>
                        <stringProp name="Argument.value">${manualUpdateJson}</stringProp>
                        <stringProp name="Argument.metadata">=</stringProp>
                      </elementProp>
                    </collectionProp>
                  </elementProp>
                </HTTPSamplerProxy>
                <hashTree>
                  <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
                    <collectionProp name="HeaderManager.headers">
                      <elementProp name="x-request-id" elementType="Header">
                        <stringProp name="Header.name">x-request-id</stringProp>
                        <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                      </elementProp>
                      <elementProp name="gtw-authorization" elementType="Header">
                        <stringProp name="Header.name">gtw-authorization</stringProp>
                        <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                      </elementProp>
                      <elementProp name="x-open-id" elementType="Header">
                        <stringProp name="Header.name">x-open-id</stringProp>
                        <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                      </elementProp>
                      <elementProp name="Accept-Language" elementType="Header">
                        <stringProp name="Header.name">Accept-Language</stringProp>
                        <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                      </elementProp>
                      <elementProp name="Content-Type" elementType="Header">
                        <stringProp name="Header.name">Content-Type</stringProp>
                        <stringProp name="Header.value">application/json</stringProp>
                      </elementProp>
                      <elementProp name="Accept-Encoding" elementType="Header">
                        <stringProp name="Header.name">Accept-Encoding</stringProp>
                        <stringProp name="Header.value">gzip, deflate, br</stringProp>
                      </elementProp>
                      <elementProp name="User-Agent" elementType="Header">
                        <stringProp name="Header.name">User-Agent</stringProp>
                        <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                      </elementProp>
                      <elementProp name="Accept" elementType="Header">
                        <stringProp name="Header.name">Accept</stringProp>
                        <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                      </elementProp>
                      <elementProp name="" elementType="Header">
                        <stringProp name="Header.name">x-session-id</stringProp>
                        <stringProp name="Header.value">${sessionId}</stringProp>
                      </elementProp>
                      <elementProp name="" elementType="Header">
                        <stringProp name="Header.name">OBD-Authorization</stringProp>
                        <stringProp name="Header.value">Bearer ${accessToken}</stringProp>
                      </elementProp>
                      <elementProp name="" elementType="Header">
                        <stringProp name="Header.name">X-KEY</stringProp>
                        <stringProp name="Header.value">${adminKey}</stringProp>
                      </elementProp>
                      <elementProp name="" elementType="Header">
                        <stringProp name="Header.name">username</stringProp>
                        <stringProp name="Header.value">JMETER</stringProp>
                      </elementProp>
                    </collectionProp>
                  </HeaderManager>
                  <hashTree/>
                  <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
                    <stringProp name="cacheKey">true</stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot;\n---------- CHECKING KYC STATUS ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime + &quot;ms&quot;);

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Trích xuất thông tin KYC
def kycStatus = jsonResponse?.payload?.kycStatus?.trim() ?: &quot;N_A&quot;;
def needsReviewCheck = jsonResponse?.payload?.needsReviewCheck ?: [];
def declinedCheck = jsonResponse?.payload?.declinedCheck ?: [];
def payload = jsonResponse?.payload ?: &quot;N_A&quot;;

// ✅ Ghi log Payload, Needs Review Check, Declined Check
log.info(&quot; Payload: &quot; + payload);

// ✅ Nếu KYC được APPROVED
if (kycStatus == &quot;APPROVED&quot;) {
    vars.put(&quot;kycStatus&quot;, kycStatus);
    vars.put(&quot;needsReviewCheck&quot;, &quot;&quot;);
    vars.put(&quot;isTriggerFinalCheck&quot;, &quot;true&quot;);
    log.info(&quot;✅ KYC is APPROVED - Stopping current loop.&quot;);
    prev.setIgnore(); // Dừng vòng lặp hiện tại
    return;
}

// ✅ Nếu KYC là &quot;DECLINED&quot;, dừng vòng lặp while nhưng tiếp tục thread
if (kycStatus == &quot;DECLINED&quot;) {
    vars.put(&quot;kycStatus&quot;, kycStatus);
    vars.put(&quot;declinedCheck&quot;, declinedCheck.join(&quot;,&quot;));
    log.info(&quot;❌ KYC DECLINED! Declined Check Reasons: &quot; + declinedCheck);
    prev.setIgnore();
    return; 
}

// ✅ Nếu KYC là &quot;NEEDS_REVIEW&quot;, tiếp tục xử lý
if (kycStatus == &quot;NEEDS_REVIEW&quot;) {
    vars.put(&quot;kycStatus&quot;, kycStatus);
    def needReview = needsReviewCheck ? needsReviewCheck.join(&quot;,&quot;) : &quot;&quot;;
    vars.put(&quot;needsReviewCheck&quot;, needReview);

    log.info(&quot;🔍 KYC NEEDS REVIEW: &quot; + needReview);

    // Nếu danh sách kiểm tra review rỗng, kích hoạt kiểm tra cuối cùng
    if (needReview.isEmpty()) {
        vars.put(&quot;isTriggerFinalCheck&quot;, &quot;true&quot;);
        log.info(&quot;⚠️ No further review required. Triggering final check.&quot;);
    }
}

// ✅ Nếu KYC không phải là &quot;N_A&quot;, xử lý tiếp tục
if (kycStatus != &quot;N_A&quot;) {
    vars.put(&quot;kycStatus&quot;, kycStatus);
    def needReview = needsReviewCheck ? needsReviewCheck.join(&quot;,&quot;) : &quot;&quot;;
    vars.put(&quot;needsReviewCheck&quot;, needReview);

    log.info(&quot; Needs Review Check: &quot; + needReview);
}

// ✅ Tăng số lần thử kiểm tra KYC
def attempts = Integer.parseInt(vars.get(&quot;attempts&quot;) ?: &quot;0&quot;) + 1;
vars.put(&quot;attempts&quot;, String.valueOf(attempts));

log.info(&quot; KYC Check Attempt: &quot; + attempts);

// ✅ Tạm dừng trước khi kiểm tra lại
Thread.sleep(3000);</stringProp>
                    <stringProp name="scriptLanguage">groovy</stringProp>
                  </JSR223PostProcessor>
                  <hashTree/>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="If is trigger final check" enabled="true">
                <stringProp name="IfController.condition">${__groovy(vars.get(&quot;isTriggerFinalCheck&quot;) != null &amp;&amp; vars.get(&quot;isTriggerFinalCheck&quot;).equals(&quot;true&quot;))}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="Manual Final update" enabled="true">
                  <intProp name="HTTPSampler.concurrentPool">6</intProp>
                  <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
                  <stringProp name="HTTPSampler.path">/v3/onboarding/admin/kyc/${onboardingId}/final-check</stringProp>
                  <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
                  <stringProp name="HTTPSampler.method">PUT</stringProp>
                  <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
                  <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
                  <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                    <collectionProp name="Arguments.arguments">
                      <elementProp name="" elementType="HTTPArgument">
                        <boolProp name="HTTPArgument.always_encode">false</boolProp>
                        <stringProp name="Argument.value">{&#xd;
	&quot;finalCheck&quot;: &quot;MANUALLY_APPROVED&quot;&#xd;
}&#xd;
</stringProp>
                        <stringProp name="Argument.metadata">=</stringProp>
                      </elementProp>
                    </collectionProp>
                  </elementProp>
                </HTTPSamplerProxy>
                <hashTree>
                  <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
                    <collectionProp name="HeaderManager.headers">
                      <elementProp name="x-request-id" elementType="Header">
                        <stringProp name="Header.name">x-request-id</stringProp>
                        <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                      </elementProp>
                      <elementProp name="gtw-authorization" elementType="Header">
                        <stringProp name="Header.name">gtw-authorization</stringProp>
                        <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                      </elementProp>
                      <elementProp name="x-open-id" elementType="Header">
                        <stringProp name="Header.name">x-open-id</stringProp>
                        <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                      </elementProp>
                      <elementProp name="Accept-Language" elementType="Header">
                        <stringProp name="Header.name">Accept-Language</stringProp>
                        <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                      </elementProp>
                      <elementProp name="Content-Type" elementType="Header">
                        <stringProp name="Header.name">Content-Type</stringProp>
                        <stringProp name="Header.value">application/json</stringProp>
                      </elementProp>
                      <elementProp name="Accept-Encoding" elementType="Header">
                        <stringProp name="Header.name">Accept-Encoding</stringProp>
                        <stringProp name="Header.value">gzip, deflate, br</stringProp>
                      </elementProp>
                      <elementProp name="User-Agent" elementType="Header">
                        <stringProp name="Header.name">User-Agent</stringProp>
                        <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                      </elementProp>
                      <elementProp name="Accept" elementType="Header">
                        <stringProp name="Header.name">Accept</stringProp>
                        <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                      </elementProp>
                      <elementProp name="" elementType="Header">
                        <stringProp name="Header.name">x-session-id</stringProp>
                        <stringProp name="Header.value">${sessionId}</stringProp>
                      </elementProp>
                      <elementProp name="" elementType="Header">
                        <stringProp name="Header.name">X-KEY</stringProp>
                        <stringProp name="Header.value">${adminKey}</stringProp>
                      </elementProp>
                      <elementProp name="" elementType="Header">
                        <stringProp name="Header.name">username</stringProp>
                        <stringProp name="Header.value">JMETER</stringProp>
                      </elementProp>
                    </collectionProp>
                  </HeaderManager>
                  <hashTree/>
                  <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
                    <stringProp name="cacheKey">true</stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- MANUAL FINAL UPDATE ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Nếu API thành công, chỉ log kết quả mà không cần hiển thị response đầy đủ
log.info(&quot;✅ Manual Final Update thành công!&quot;);</stringProp>
                    <stringProp name="scriptLanguage">groovy</stringProp>
                  </JSR223PostProcessor>
                  <hashTree/>
                </hashTree>
              </hashTree>
            </hashTree>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.11 Update Status bypass OTP" enabled="true">
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/api/config-service/v1/config/update</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;configType&quot;: &quot;AUTHENTICATION_CONFIG&quot;,&#xd;
    &quot;key&quot;: &quot;is_account_whitelist_enabled&quot;,&#xd;
    &quot;value&quot;: &quot;true&quot;,&#xd;
    &quot;dataType&quot;: &quot;BOOLEAN&quot;,&#xd;
    &quot;scope&quot;: &quot;internal&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name"></stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- UPDATE STATUS BYPASS OTP ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Nếu API thành công, chỉ log kết quả mà không cần hiển thị response đầy đủ
log.info(&quot;✅ Update Status bypass OTP thành công!&quot;);</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.12 Create bypass OTP" enabled="true">
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/api/config-service/v1/config/create</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;configType&quot;: &quot;AUTHENTICATION_CONFIG_ACCOUNT_WHITELIST&quot;,&#xd;
    &quot;key&quot;: &quot;${cifNumber}&quot;,&#xd;
    &quot;value&quot;: &quot;{\&quot;cif\&quot;:\&quot;${cifNumber}\&quot;,\&quot;otp\&quot;:\&quot;123456\&quot;,\&quot;isBypassFaceCheck\&quot;:true}&quot;,&#xd;
    &quot;dataType&quot;: &quot;JSON&quot;,&#xd;
    &quot;scope&quot;: &quot;internal&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name"></stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${publicKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- CREATE BYPASS OTP ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Nếu API thành công, chỉ log kết quả mà không cần hiển thị response đầy đủ
log.info(&quot;✅ Create Bypass OTP thành công!&quot;);</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <WhileController guiclass="WhileControllerGui" testclass="WhileController" testname="2.13 Check account creation status" enabled="true">
            <stringProp name="WhileController.condition">${__groovy(
	 def attempts = (vars.get(&quot;attemptsCreateAccount&quot;) ?: &quot;0&quot;) as Integer;
	 if (attempts &gt;= 10) { return false; } 
	 else { return vars.get(&quot;accountCreationStatusOnboarded&quot;) != &quot;SUCCESS&quot;; }
)}</stringProp>
          </WhileController>
          <hashTree>
            <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.13.1 Get Account Creation Status" enabled="true">
              <intProp name="HTTPSampler.concurrentPool">6</intProp>
              <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
              <stringProp name="HTTPSampler.path">/v2/onboarding/accountCreation/${onboardingId}/status</stringProp>
              <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
              <stringProp name="HTTPSampler.method">GET</stringProp>
              <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
              <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
              <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                <collectionProp name="Arguments.arguments">
                  <elementProp name="" elementType="HTTPArgument">
                    <boolProp name="HTTPArgument.always_encode">false</boolProp>
                    <stringProp name="Argument.value">{   &#xd;
    &quot;onboardId&quot;:&quot;${onboardingId}&quot;&#xd;
}</stringProp>
                    <stringProp name="Argument.metadata">=</stringProp>
                  </elementProp>
                </collectionProp>
              </elementProp>
            </HTTPSamplerProxy>
            <hashTree>
              <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
                <collectionProp name="HeaderManager.headers">
                  <elementProp name="x-request-id" elementType="Header">
                    <stringProp name="Header.name">x-request-id</stringProp>
                    <stringProp name="Header.value">bdb97a68-7821-4c9a-8f91-a01c23459d6c</stringProp>
                  </elementProp>
                  <elementProp name="gtw-authorization" elementType="Header">
                    <stringProp name="Header.name">gtw-authorization</stringProp>
                    <stringProp name="Header.value">Bearer ${access_token}</stringProp>
                  </elementProp>
                  <elementProp name="x-open-id" elementType="Header">
                    <stringProp name="Header.name">x-open-id</stringProp>
                    <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                  </elementProp>
                  <elementProp name="Accept-Language" elementType="Header">
                    <stringProp name="Header.name">Accept-Language</stringProp>
                    <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                  </elementProp>
                  <elementProp name="Content-Type" elementType="Header">
                    <stringProp name="Header.name">Content-Type</stringProp>
                    <stringProp name="Header.value">application/json</stringProp>
                  </elementProp>
                  <elementProp name="Accept-Encoding" elementType="Header">
                    <stringProp name="Header.name">Accept-Encoding</stringProp>
                    <stringProp name="Header.value">gzip, deflate, br</stringProp>
                  </elementProp>
                  <elementProp name="User-Agent" elementType="Header">
                    <stringProp name="Header.name">User-Agent</stringProp>
                    <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                  </elementProp>
                  <elementProp name="Accept" elementType="Header">
                    <stringProp name="Header.name">Accept</stringProp>
                    <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                  </elementProp>
                  <elementProp name="" elementType="Header">
                    <stringProp name="Header.name">X-KEY</stringProp>
                    <stringProp name="Header.value">${publicKey}</stringProp>
                  </elementProp>
                </collectionProp>
              </HeaderManager>
              <hashTree/>
              <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
                <stringProp name="scriptLanguage">groovy</stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="cacheKey">true</stringProp>
                <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot;\n---------- ACCOUNT CREATION STATUS ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode()?.toString();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime + &quot;ms&quot;);

// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    def attempts = Integer.parseInt(vars.get(&quot;attempts&quot;) ?: &quot;0&quot;) + 1;
    vars.put(&quot;attempts&quot;, String.valueOf(attempts));

    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    log.error(&quot; 🔄 Creation Account Check Attempt: &quot; + attempts);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}


// ✅ Tăng số lần thử kiểm tra Creation Account
def attemptsCreateAccount = Integer.parseInt(vars.get(&quot;attemptsCreateAccount&quot;) ?: &quot;0&quot;) + 1;
vars.put(&quot;attemptsCreateAccount&quot;, String.valueOf(attemptsCreateAccount));
//log.info(&quot; Creation Account Check Attempt: &quot; + attemptsCreateAccount);

// ✅ Trích xuất trạng thái tạo tài khoản
try {
    def accountCreationStatusOnboarded = jsonResponse?.payload?.status?.trim() ?: &quot;UNKNOWN&quot;;
    vars.put(&quot;accountCreationStatusOnboarded&quot;, accountCreationStatusOnboarded);
    log.info(&quot;✅ Account creation status: &quot; + accountCreationStatusOnboarded);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi khi lấy trạng thái tài khoản: &quot; + e.getMessage());
}

// ✅ Tạm dừng 300ms trước lần thử tiếp theo
Thread.sleep(300);</stringProp>
              </JSR223PostProcessor>
              <hashTree/>
            </hashTree>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.14 Get Account Details - Prospect" enabled="true">
            <intProp name="HTTPSampler.concurrentPool">6</intProp>
            <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
            <stringProp name="HTTPSampler.path">/v3/onboarding/admin/prospect/${onboardingId}</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">GET</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">false</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="User Defined Variables">
              <collectionProp name="Arguments.arguments"/>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">dcb51815-7759-41d8-8fd6-46b32e241acf</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="baggage" elementType="Header">
                  <stringProp name="Header.name">baggage</stringProp>
                  <stringProp name="Header.value">sentry-environment=uat,sentry-transaction=StartupScreen,sentry-public_key=a8650128baf78c0abc77876f8736238f,sentry-trace_id=ae79a0eed0354e439ab2d6820a04d617,sentry-sample_rate=0.85</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="sentry-trace" elementType="Header">
                  <stringProp name="Header.name">sentry-trace</stringProp>
                  <stringProp name="Header.value">ae79a0eed0354e439ab2d6820a04d617-ae34fb51315f7476-1</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${adminKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- GET ACCOUNT DETAILS - PROSPECT ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Parse JSON an toàn
def jsonResponse;
try {
    jsonResponse = new JsonSlurper().parseText(response);
} catch (Exception e) {
    log.error(&quot;❌ Lỗi parse JSON: &quot; + e.getMessage());
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

try {
    log.info(&quot; Prospect ID: &quot; + vars.get(&quot;onboardingId&quot;));

    // ✅ Trích xuất dữ liệu Prospect từ payload một cách an toàn
    def payload = jsonResponse?.payload ?: [:];

    def fullnameProspect = payload?.customerDetails?.fullName ?: &quot;N/A&quot;;
    vars.put(&quot;fullnameProspect&quot;, fullnameProspect);
    log.info(&quot; Full Name: &quot; + fullnameProspect);

    def phoneNumberProspect = payload?.phoneNumber ?: &quot;N/A&quot;;
    vars.put(&quot;phoneNumberProspect&quot;, phoneNumberProspect);
    log.info(&quot; Phone Number: &quot; + phoneNumberProspect);

    def idNumberProspect = payload?.customerDetails?.idNumber ?: &quot;N/A&quot;;
    vars.put(&quot;idNumberProspect&quot;, idNumberProspect);
    log.info(&quot; ID Number: &quot; + idNumberProspect);

    def cifNumberProspect = payload?.accountCreation?.cifNumber ?: &quot;N/A&quot;;
    vars.put(&quot;cifNumberProspect&quot;, cifNumberProspect);
    log.info(&quot; CIF Number: &quot; + cifNumberProspect);

    def vikkiAccountNumberProspect = payload?.accountCreation?.vikkiAccountNumber ?: &quot;N/A&quot;;
    vars.put(&quot;vikkiAccountNumberProspect&quot;, vikkiAccountNumberProspect);
    log.info(&quot; Vikki Account Number: &quot; + vikkiAccountNumberProspect);

    def hdbCifNumberProspect = payload?.hdb?.hdbCifNumber ?: &quot;N/A&quot;;
    vars.put(&quot;hdbCifNumberProspect&quot;, hdbCifNumberProspect);
    log.info(&quot; HDBank CIF Number: &quot; + hdbCifNumberProspect);

    def caseIDProspect = payload?.caseId ?: &quot;N/A&quot;;
    vars.put(&quot;caseIDProspect&quot;, caseIDProspect);
    log.info(&quot; Case ID: &quot; + caseIDProspect);

    log.info(&quot;✅ Lấy thông tin Prospect thành công!&quot;);

} catch (Exception e1) {
    log.error(&quot;❌ NOT FOUND YOUR INFO: &quot; + e1.getMessage());
}</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="2.15 Up vKYC" enabled="true">
            <stringProp name="HTTPSampler.path">/v2/onboarding/admin/kyc/video</stringProp>
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
              <collectionProp name="Arguments.arguments">
                <elementProp name="" elementType="HTTPArgument">
                  <boolProp name="HTTPArgument.always_encode">false</boolProp>
                  <stringProp name="Argument.value">{&#xd;
    &quot;cifNumber&quot;: &quot;${cifNumber}&quot;,&#xd;
    &quot;videoCaseId&quot;: &quot;&quot;,&#xd;
    &quot;status&quot;: &quot;PASS&quot;,&#xd;
    &quot;caseType&quot;: &quot;LIMIT_VKYC&quot;&#xd;
}</stringProp>
                  <stringProp name="Argument.metadata">=</stringProp>
                </elementProp>
              </collectionProp>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="x-request-id" elementType="Header">
                  <stringProp name="Header.name">x-request-id</stringProp>
                  <stringProp name="Header.value">dcb51815-7759-41d8-8fd6-46b32e241acf</stringProp>
                </elementProp>
                <elementProp name="gtw-authorization" elementType="Header">
                  <stringProp name="Header.name">gtw-authorization</stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="baggage" elementType="Header">
                  <stringProp name="Header.name">baggage</stringProp>
                  <stringProp name="Header.value">sentry-environment=uat,sentry-transaction=StartupScreen,sentry-public_key=a8650128baf78c0abc77876f8736238f,sentry-trace_id=ae79a0eed0354e439ab2d6820a04d617,sentry-sample_rate=0.85</stringProp>
                </elementProp>
                <elementProp name="Accept-Language" elementType="Header">
                  <stringProp name="Header.name">Accept-Language</stringProp>
                  <stringProp name="Header.value">en-GB,en-US;q=0.9,en;q=0.8</stringProp>
                </elementProp>
                <elementProp name="sentry-trace" elementType="Header">
                  <stringProp name="Header.name">sentry-trace</stringProp>
                  <stringProp name="Header.value">ae79a0eed0354e439ab2d6820a04d617-ae34fb51315f7476-1</stringProp>
                </elementProp>
                <elementProp name="Accept" elementType="Header">
                  <stringProp name="Header.name">Accept</stringProp>
                  <stringProp name="Header.value">application/json, text/plain, */*</stringProp>
                </elementProp>
                <elementProp name="x-open-id" elementType="Header">
                  <stringProp name="Header.name">x-open-id</stringProp>
                  <stringProp name="Header.value">7b0e270b-c4f4-4cc4-826c-f324bd2d6684</stringProp>
                </elementProp>
                <elementProp name="Content-Type" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="Accept-Encoding" elementType="Header">
                  <stringProp name="Header.name">Accept-Encoding</stringProp>
                  <stringProp name="Header.value">gzip, deflate, br</stringProp>
                </elementProp>
                <elementProp name="User-Agent" elementType="Header">
                  <stringProp name="Header.name">User-Agent</stringProp>
                  <stringProp name="Header.value">Vikki%20Uat/1698985660 CFNetwork/1410.0.3 Darwin/22.6.0</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">${adminKey}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
            <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 PostProcessor" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import groovy.json.JsonSlurper;

log.info(&quot; \n ---------- UP vKYC ----------&quot;);

// ✅ Lấy thông tin từ request trước đó
def responseCode = prev.getResponseCode();
def responseMessage = prev.getResponseMessage();
def responseTime = prev.getTime(); // Response time in milliseconds
def requestUrl = prev.getURL().toString(); // Lấy URL của request
def response = prev.getResponseDataAsString().trim();

// ✅ Log thông tin cơ bản về request để hỗ trợ trace issue
log.info( requestUrl + &quot; | Time: &quot; + responseTime);


// ✅ Nếu response code != 200, log lỗi &amp; toàn bộ response để debug
if (responseCode != &quot;200&quot;) {
    log.error(&quot;❌ API Lỗi! Response Code: &quot; + responseCode + &quot; | Message: &quot; + responseMessage);
    log.error(&quot; Full Response: \n&quot; + response);
    return;
}

// ✅ Nếu API thành công, chỉ log kết quả mà không cần hiển thị response đầy đủ
log.info(&quot;✅ Up vKYC thành công!&quot;);</stringProp>
            </JSR223PostProcessor>
            <hashTree/>
          </hashTree>
          <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="Incoming transaction from HDB" enabled="false">
            <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
            <stringProp name="HTTPSampler.method">POST</stringProp>
            <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
            <boolProp name="HTTPSampler.postBodyRaw">false</boolProp>
            <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="User Defined Variables">
              <collectionProp name="Arguments.arguments"/>
            </elementProp>
          </HTTPSamplerProxy>
          <hashTree>
            <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 PreProcessor" enabled="false">
              <stringProp name="scriptLanguage">beanshell</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">true</stringProp>
              <stringProp name="script">import javax.crypto.Mac
import javax.crypto.spec.SecretKeySpec
import org.apache.commons.codec.binary.Base64
import groovy.json.JsonOutput

// 🔹 Tạo timestamp
def current = new Date()
def timestamp = current.format(&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSS&apos;Z&apos;&quot;)
log.info(&quot;timestamp: &quot; + timestamp)
vars.put(&quot;timestamp&quot;, timestamp)

// 🔹 Tạo refNo (random số 12 chữ số)
def refNo = (Math.abs(new Random().nextLong()) % 900000000000) + 100000000000
log.info(&quot;refNo: &quot; + refNo)
vars.put(&quot;refNo&quot;, refNo.toString())

// 🔹 Set giá trị tài khoản
def vikkiAccountNumberProspect = &quot;880679145&quot;  // Thay bằng biến môi trường nếu cần

// 🔹 Chuẩn bị body JSON (format chuẩn)
def body = JsonOutput.toJson([
    amount: 490000000,
    refNo: vars.get(&quot;refNo&quot;),
    currency: &quot;VND&quot;,
    transmissionDateTime: vars.get(&quot;timestamp&quot;),
    fromAccount: &quot;0421000487800&quot;,
    fromAccountName: &quot;ADECCO HR Vietnam&quot;,
    toAccount: vikkiAccountNumberProspect,
    contentTransfers: &quot;FinX Bonus&quot;,
    timestamp: vars.get(&quot;timestamp&quot;)
])

log.info(&quot;Request Body: &quot; + body)
vars.put(&quot;requestBody&quot;, body)

// 🔹 Chuẩn bị raw string để ký (giữ nguyên format như Postman)
def raw = vars.get(&quot;timestamp&quot;) + &quot;POST&quot; + &quot;/api/payment-integration/v1/hdb/transaction&quot; + body
log.info(&quot;Raw String to Sign: &quot; + raw)
vars.put(&quot;rawString&quot;, raw)

// 🔹 Ký HMAC-SHA256 + Encode Base64
def secret = &quot;th6r+5hgK+X+Tt9J&quot;  // Thay bằng giá trị thật nếu cần
Mac sha256_HMAC = Mac.getInstance(&quot;HmacSHA256&quot;)
SecretKeySpec secret_key = new SecretKeySpec(secret.getBytes(&quot;UTF-8&quot;), &quot;HmacSHA256&quot;)
sha256_HMAC.init(secret_key)

byte[] hash = sha256_HMAC.doFinal(raw.getBytes(&quot;UTF-8&quot;))
String signature = Base64.encodeBase64String(hash)

log.info(&quot;Generated X-Payload-Signature: &quot; + signature)
vars.put(&quot;signature&quot;, signature)
</stringProp>
            </JSR223PreProcessor>
            <hashTree/>
            <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="false">
              <collectionProp name="HeaderManager.headers">
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name"></stringProp>
                  <stringProp name="Header.value"></stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">Content-Type</stringProp>
                  <stringProp name="Header.value">application/json</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-KEY</stringProp>
                  <stringProp name="Header.value">GfS39omUfRHReT3G02sSYTIpF</stringProp>
                </elementProp>
                <elementProp name="" elementType="Header">
                  <stringProp name="Header.name">X-Payload-Signature</stringProp>
                  <stringProp name="Header.value">${signature}</stringProp>
                </elementProp>
              </collectionProp>
            </HeaderManager>
            <hashTree/>
          </hashTree>
        </hashTree>
      </hashTree>
      <ResultCollector guiclass="ViewResultsFullVisualizer" testclass="ResultCollector" testname="View Results Tree">
        <boolProp name="ResultCollector.error_logging">false</boolProp>
        <objProp>
          <name>saveConfig</name>
          <value class="SampleSaveConfiguration">
            <time>true</time>
            <latency>true</latency>
            <timestamp>true</timestamp>
            <success>true</success>
            <label>true</label>
            <code>true</code>
            <message>true</message>
            <threadName>true</threadName>
            <dataType>true</dataType>
            <encoding>false</encoding>
            <assertions>true</assertions>
            <subresults>true</subresults>
            <responseData>false</responseData>
            <samplerData>false</samplerData>
            <xml>false</xml>
            <fieldNames>true</fieldNames>
            <responseHeaders>false</responseHeaders>
            <requestHeaders>false</requestHeaders>
            <responseDataOnError>false</responseDataOnError>
            <saveAssertionResultsFailureMessage>true</saveAssertionResultsFailureMessage>
            <assertionsResultsToSave>0</assertionsResultsToSave>
            <bytes>true</bytes>
            <sentBytes>true</sentBytes>
            <url>true</url>
            <threadCounts>true</threadCounts>
            <idleTime>true</idleTime>
            <connectTime>true</connectTime>
          </value>
        </objProp>
        <stringProp name="filename"></stringProp>
      </ResultCollector>
      <hashTree/>
    </hashTree>
  </hashTree>
</jmeterTestPlan>
